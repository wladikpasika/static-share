var core=(()=>{var mi=Object.create;var ne=Object.defineProperty,pi=Object.defineProperties,hi=Object.getOwnPropertyDescriptor,yi=Object.getOwnPropertyDescriptors,fi=Object.getOwnPropertyNames,Re=Object.getOwnPropertySymbols,gi=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty,bi=Object.prototype.propertyIsEnumerable;var ie=(n,t,e)=>t in n?ne(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,N=(n,t)=>{for(var e in t||(t={}))Ue.call(t,e)&&ie(n,e,t[e]);if(Re)for(var e of Re(t))bi.call(t,e)&&ie(n,e,t[e]);return n},j=(n,t)=>pi(n,yi(t));var E=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var wi=(n,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of fi(t))!Ue.call(n,i)&&i!==e&&ne(n,i,{get:()=>t[i],enumerable:!(a=hi(t,i))||a.enumerable});return n};var Si=(n,t,e)=>(e=n!=null?mi(gi(n)):{},wi(t||!n||!n.__esModule?ne(e,"default",{value:n,enumerable:!0}):e,n));var oe=(n,t,e)=>(ie(n,typeof t!="symbol"?t+"":t,e),e);var m=(n,t,e)=>new Promise((a,i)=>{var o=l=>{try{r(e.next(l))}catch(c){i(c)}},s=l=>{try{r(e.throw(l))}catch(c){i(c)}},r=l=>l.done?a(l.value):Promise.resolve(l.value).then(o,s);r((e=e.apply(n,t)).next())});var ea=E((Os,ta)=>{ta.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var at=E(ct=>{var de,tn=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];ct.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};ct.getSymbolTotalCodewords=function(t){return tn[t]};ct.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};ct.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');de=t};ct.isKanjiModeEnabled=function(){return typeof de!="undefined"};ct.toSJIS=function(t){return de(t)}});var Ht=E(H=>{H.L={bit:1};H.M={bit:0};H.Q={bit:3};H.H={bit:2};function en(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return H.L;case"m":case"medium":return H.M;case"q":case"quartile":return H.Q;case"h":case"high":return H.H;default:throw new Error("Unknown EC Level: "+n)}}H.isValid=function(t){return t&&typeof t.bit!="undefined"&&t.bit>=0&&t.bit<4};H.from=function(t,e){if(H.isValid(t))return t;try{return en(t)}catch(a){return e}}});var na=E((Ds,ia)=>{function aa(){this.buffer=[],this.length=0}aa.prototype={get:function(n){let t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};ia.exports=aa});var sa=E((Rs,oa)=>{function At(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}At.prototype.set=function(n,t,e,a){let i=n*this.size+t;this.data[i]=e,a&&(this.reservedBit[i]=!0)};At.prototype.get=function(n,t){return this.data[n*this.size+t]};At.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};At.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};oa.exports=At});var ra=E(Wt=>{var an=at().getSymbolSize;Wt.getRowColCoords=function(t){if(t===1)return[];let e=Math.floor(t/7)+2,a=an(t),i=a===145?26:Math.ceil((a-13)/(2*e-2))*2,o=[a-7];for(let s=1;s<e-1;s++)o[s]=o[s-1]-i;return o.push(6),o.reverse()};Wt.getPositions=function(t){let e=[],a=Wt.getRowColCoords(t),i=a.length;for(let o=0;o<i;o++)for(let s=0;s<i;s++)o===0&&s===0||o===0&&s===i-1||o===i-1&&s===0||e.push([a[o],a[s]]);return e}});var da=E(ca=>{var nn=at().getSymbolSize,la=7;ca.getPositions=function(t){let e=nn(t);return[[0,0],[e-la,0],[0,e-la]]}});var ua=E(A=>{A.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var dt={N1:3,N2:3,N3:40,N4:10};A.isValid=function(t){return t!=null&&t!==""&&!isNaN(t)&&t>=0&&t<=7};A.from=function(t){return A.isValid(t)?parseInt(t,10):void 0};A.getPenaltyN1=function(t){let e=t.size,a=0,i=0,o=0,s=null,r=null;for(let l=0;l<e;l++){i=o=0,s=r=null;for(let c=0;c<e;c++){let d=t.get(l,c);d===s?i++:(i>=5&&(a+=dt.N1+(i-5)),s=d,i=1),d=t.get(c,l),d===r?o++:(o>=5&&(a+=dt.N1+(o-5)),r=d,o=1)}i>=5&&(a+=dt.N1+(i-5)),o>=5&&(a+=dt.N1+(o-5))}return a};A.getPenaltyN2=function(t){let e=t.size,a=0;for(let i=0;i<e-1;i++)for(let o=0;o<e-1;o++){let s=t.get(i,o)+t.get(i,o+1)+t.get(i+1,o)+t.get(i+1,o+1);(s===4||s===0)&&a++}return a*dt.N2};A.getPenaltyN3=function(t){let e=t.size,a=0,i=0,o=0;for(let s=0;s<e;s++){i=o=0;for(let r=0;r<e;r++)i=i<<1&2047|t.get(s,r),r>=10&&(i===1488||i===93)&&a++,o=o<<1&2047|t.get(r,s),r>=10&&(o===1488||o===93)&&a++}return a*dt.N3};A.getPenaltyN4=function(t){let e=0,a=t.data.length;for(let o=0;o<a;o++)e+=t.data[o];return Math.abs(Math.ceil(e*100/a/5)-10)*dt.N4};function on(n,t,e){switch(n){case A.Patterns.PATTERN000:return(t+e)%2===0;case A.Patterns.PATTERN001:return t%2===0;case A.Patterns.PATTERN010:return e%3===0;case A.Patterns.PATTERN011:return(t+e)%3===0;case A.Patterns.PATTERN100:return(Math.floor(t/2)+Math.floor(e/3))%2===0;case A.Patterns.PATTERN101:return t*e%2+t*e%3===0;case A.Patterns.PATTERN110:return(t*e%2+t*e%3)%2===0;case A.Patterns.PATTERN111:return(t*e%3+(t+e)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}A.applyMask=function(t,e){let a=e.size;for(let i=0;i<a;i++)for(let o=0;o<a;o++)e.isReserved(o,i)||e.xor(o,i,on(t,o,i))};A.getBestMask=function(t,e){let a=Object.keys(A.Patterns).length,i=0,o=1/0;for(let s=0;s<a;s++){e(s),A.applyMask(s,t);let r=A.getPenaltyN1(t)+A.getPenaltyN2(t)+A.getPenaltyN3(t)+A.getPenaltyN4(t);A.applyMask(s,t),r<o&&(o=r,i=s)}return i}});var me=E(ue=>{var it=Ht(),Gt=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Kt=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];ue.getBlocksCount=function(t,e){switch(e){case it.L:return Gt[(t-1)*4+0];case it.M:return Gt[(t-1)*4+1];case it.Q:return Gt[(t-1)*4+2];case it.H:return Gt[(t-1)*4+3];default:return}};ue.getTotalCodewordsCount=function(t,e){switch(e){case it.L:return Kt[(t-1)*4+0];case it.M:return Kt[(t-1)*4+1];case it.Q:return Kt[(t-1)*4+2];case it.H:return Kt[(t-1)*4+3];default:return}}});var ma=E(Zt=>{var It=new Uint8Array(512),Yt=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)It[e]=t,Yt[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)It[e]=It[e-255]})();Zt.log=function(t){if(t<1)throw new Error("log("+t+")");return Yt[t]};Zt.exp=function(t){return It[t]};Zt.mul=function(t,e){return t===0||e===0?0:It[Yt[t]+Yt[e]]}});var pa=E(Bt=>{var pe=ma();Bt.mul=function(t,e){let a=new Uint8Array(t.length+e.length-1);for(let i=0;i<t.length;i++)for(let o=0;o<e.length;o++)a[i+o]^=pe.mul(t[i],e[o]);return a};Bt.mod=function(t,e){let a=new Uint8Array(t);for(;a.length-e.length>=0;){let i=a[0];for(let s=0;s<e.length;s++)a[s]^=pe.mul(e[s],i);let o=0;for(;o<a.length&&a[o]===0;)o++;a=a.slice(o)}return a};Bt.generateECPolynomial=function(t){let e=new Uint8Array([1]);for(let a=0;a<t;a++)e=Bt.mul(e,new Uint8Array([1,pe.exp(a)]));return e}});var fa=E((Hs,ya)=>{var ha=pa();function he(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}he.prototype.initialize=function(t){this.degree=t,this.genPoly=ha.generateECPolynomial(this.degree)};he.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");let e=new Uint8Array(t.length+this.degree);e.set(t);let a=ha.mod(e,this.genPoly),i=this.degree-a.length;if(i>0){let o=new Uint8Array(this.degree);return o.set(a,i),o}return a};ya.exports=he});var ye=E(ga=>{ga.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}});var fe=E(X=>{var ba="[0-9]+",sn="[A-Z $%*+\\-./:]+",Nt="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Nt=Nt.replace(/u/g,"\\u");var rn="(?:(?![A-Z0-9 $%*+\\-./:]|"+Nt+`)(?:.|[\r
]))+`;X.KANJI=new RegExp(Nt,"g");X.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");X.BYTE=new RegExp(rn,"g");X.NUMERIC=new RegExp(ba,"g");X.ALPHANUMERIC=new RegExp(sn,"g");var ln=new RegExp("^"+Nt+"$"),cn=new RegExp("^"+ba+"$"),dn=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");X.testKanji=function(t){return ln.test(t)};X.testNumeric=function(t){return cn.test(t)};X.testAlphanumeric=function(t){return dn.test(t)}});var nt=E(O=>{var un=ye(),ge=fe();O.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};O.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};O.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};O.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};O.MIXED={bit:-1};O.getCharCountIndicator=function(t,e){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!un.isValid(e))throw new Error("Invalid version: "+e);return e>=1&&e<10?t.ccBits[0]:e<27?t.ccBits[1]:t.ccBits[2]};O.getBestModeForData=function(t){return ge.testNumeric(t)?O.NUMERIC:ge.testAlphanumeric(t)?O.ALPHANUMERIC:ge.testKanji(t)?O.KANJI:O.BYTE};O.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")};O.isValid=function(t){return t&&t.bit&&t.ccBits};function mn(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return O.NUMERIC;case"alphanumeric":return O.ALPHANUMERIC;case"kanji":return O.KANJI;case"byte":return O.BYTE;default:throw new Error("Unknown mode: "+n)}}O.from=function(t,e){if(O.isValid(t))return t;try{return mn(t)}catch(a){return e}}});var qa=E(ut=>{var Qt=at(),pn=me(),wa=Ht(),ot=nt(),be=ye(),Ca=7973,Sa=Qt.getBCHDigit(Ca);function hn(n,t,e){for(let a=1;a<=40;a++)if(t<=ut.getCapacity(a,e,n))return a}function va(n,t){return ot.getCharCountIndicator(n,t)+4}function yn(n,t){let e=0;return n.forEach(function(a){let i=va(a.mode,t);e+=i+a.getBitsLength()}),e}function fn(n,t){for(let e=1;e<=40;e++)if(yn(n,e)<=ut.getCapacity(e,t,ot.MIXED))return e}ut.from=function(t,e){return be.isValid(t)?parseInt(t,10):e};ut.getCapacity=function(t,e,a){if(!be.isValid(t))throw new Error("Invalid QR Code version");typeof a=="undefined"&&(a=ot.BYTE);let i=Qt.getSymbolTotalCodewords(t),o=pn.getTotalCodewordsCount(t,e),s=(i-o)*8;if(a===ot.MIXED)return s;let r=s-va(a,t);switch(a){case ot.NUMERIC:return Math.floor(r/10*3);case ot.ALPHANUMERIC:return Math.floor(r/11*2);case ot.KANJI:return Math.floor(r/13);case ot.BYTE:default:return Math.floor(r/8)}};ut.getBestVersionForData=function(t,e){let a,i=wa.from(e,wa.M);if(Array.isArray(t)){if(t.length>1)return fn(t,i);if(t.length===0)return 1;a=t[0]}else a=t;return hn(a.mode,a.getLength(),i)};ut.getEncodedBits=function(t){if(!be.isValid(t)||t<7)throw new Error("Invalid QR Code version");let e=t<<12;for(;Qt.getBCHDigit(e)-Sa>=0;)e^=Ca<<Qt.getBCHDigit(e)-Sa;return t<<12|e}});var La=E(Ea=>{var we=at(),_a=1335,gn=21522,ka=we.getBCHDigit(_a);Ea.getEncodedBits=function(t,e){let a=t.bit<<3|e,i=a<<10;for(;we.getBCHDigit(i)-ka>=0;)i^=_a<<we.getBCHDigit(i)-ka;return(a<<10|i)^gn}});var Pa=E((Qs,xa)=>{var bn=nt();function St(n){this.mode=bn.NUMERIC,this.data=n.toString()}St.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};St.prototype.getLength=function(){return this.data.length};St.prototype.getBitsLength=function(){return St.getBitsLength(this.data.length)};St.prototype.write=function(t){let e,a,i;for(e=0;e+3<=this.data.length;e+=3)a=this.data.substr(e,3),i=parseInt(a,10),t.put(i,10);let o=this.data.length-e;o>0&&(a=this.data.substr(e),i=parseInt(a,10),t.put(i,o*3+1))};xa.exports=St});var Ia=E((Xs,Aa)=>{var wn=nt(),Se=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ct(n){this.mode=wn.ALPHANUMERIC,this.data=n}Ct.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Ct.prototype.getLength=function(){return this.data.length};Ct.prototype.getBitsLength=function(){return Ct.getBitsLength(this.data.length)};Ct.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let a=Se.indexOf(this.data[e])*45;a+=Se.indexOf(this.data[e+1]),t.put(a,11)}this.data.length%2&&t.put(Se.indexOf(this.data[e]),6)};Aa.exports=Ct});var Na=E((tr,Ba)=>{"use strict";Ba.exports=function(t){for(var e=[],a=t.length,i=0;i<a;i++){var o=t.charCodeAt(i);if(o>=55296&&o<=56319&&a>i+1){var s=t.charCodeAt(i+1);s>=56320&&s<=57343&&(o=(o-55296)*1024+s-56320+65536,i+=1)}if(o<128){e.push(o);continue}if(o<2048){e.push(o>>6|192),e.push(o&63|128);continue}if(o<55296||o>=57344&&o<65536){e.push(o>>12|224),e.push(o>>6&63|128),e.push(o&63|128);continue}if(o>=65536&&o<=1114111){e.push(o>>18|240),e.push(o>>12&63|128),e.push(o>>6&63|128),e.push(o&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer}});var Oa=E((er,Ta)=>{var Sn=Na(),Cn=nt();function vt(n){this.mode=Cn.BYTE,typeof n=="string"&&(n=Sn(n)),this.data=new Uint8Array(n)}vt.getBitsLength=function(t){return t*8};vt.prototype.getLength=function(){return this.data.length};vt.prototype.getBitsLength=function(){return vt.getBitsLength(this.data.length)};vt.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};Ta.exports=vt});var Fa=E((ar,Ma)=>{var vn=nt(),qn=at();function qt(n){this.mode=vn.KANJI,this.data=n}qt.getBitsLength=function(t){return t*13};qt.prototype.getLength=function(){return this.data.length};qt.prototype.getBitsLength=function(){return qt.getBitsLength(this.data.length)};qt.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=qn.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};Ma.exports=qt});var Da=E((ir,Ce)=>{"use strict";var Tt={single_source_shortest_paths:function(n,t,e){var a={},i={};i[t]=0;var o=Tt.PriorityQueue.make();o.push(t,0);for(var s,r,l,c,d,h,p,g,k;!o.empty();){s=o.pop(),r=s.value,c=s.cost,d=n[r]||{};for(l in d)d.hasOwnProperty(l)&&(h=d[l],p=c+h,g=i[l],k=typeof i[l]=="undefined",(k||g>p)&&(i[l]=p,o.push(l,p),a[l]=r))}if(typeof e!="undefined"&&typeof i[e]=="undefined"){var I=["Could not find a path from ",t," to ",e,"."].join("");throw new Error(I)}return a},extract_shortest_path_from_predecessor_list:function(n,t){for(var e=[],a=t,i;a;)e.push(a),i=n[a],a=n[a];return e.reverse(),e},find_path:function(n,t,e){var a=Tt.single_source_shortest_paths(n,t,e);return Tt.extract_shortest_path_from_predecessor_list(a,e)},PriorityQueue:{make:function(n){var t=Tt.PriorityQueue,e={},a;n=n||{};for(a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e.queue=[],e.sorter=n.sorter||t.default_sorter,e},default_sorter:function(n,t){return n.cost-t.cost},push:function(n,t){var e={value:n,cost:t};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof Ce!="undefined"&&(Ce.exports=Tt)});var Ha=E(kt=>{var _=nt(),$a=Pa(),Va=Ia(),ja=Oa(),Ja=Fa(),Ot=fe(),Xt=at(),kn=Da();function Ra(n){return unescape(encodeURIComponent(n)).length}function Mt(n,t,e){let a=[],i;for(;(i=n.exec(e))!==null;)a.push({data:i[0],index:i.index,mode:t,length:i[0].length});return a}function za(n){let t=Mt(Ot.NUMERIC,_.NUMERIC,n),e=Mt(Ot.ALPHANUMERIC,_.ALPHANUMERIC,n),a,i;return Xt.isKanjiModeEnabled()?(a=Mt(Ot.BYTE,_.BYTE,n),i=Mt(Ot.KANJI,_.KANJI,n)):(a=Mt(Ot.BYTE_KANJI,_.BYTE,n),i=[]),t.concat(e,a,i).sort(function(s,r){return s.index-r.index}).map(function(s){return{data:s.data,mode:s.mode,length:s.length}})}function ve(n,t){switch(t){case _.NUMERIC:return $a.getBitsLength(n);case _.ALPHANUMERIC:return Va.getBitsLength(n);case _.KANJI:return Ja.getBitsLength(n);case _.BYTE:return ja.getBitsLength(n)}}function _n(n){return n.reduce(function(t,e){let a=t.length-1>=0?t[t.length-1]:null;return a&&a.mode===e.mode?(t[t.length-1].data+=e.data,t):(t.push(e),t)},[])}function En(n){let t=[];for(let e=0;e<n.length;e++){let a=n[e];switch(a.mode){case _.NUMERIC:t.push([a,{data:a.data,mode:_.ALPHANUMERIC,length:a.length},{data:a.data,mode:_.BYTE,length:a.length}]);break;case _.ALPHANUMERIC:t.push([a,{data:a.data,mode:_.BYTE,length:a.length}]);break;case _.KANJI:t.push([a,{data:a.data,mode:_.BYTE,length:Ra(a.data)}]);break;case _.BYTE:t.push([{data:a.data,mode:_.BYTE,length:Ra(a.data)}])}}return t}function Ln(n,t){let e={},a={start:{}},i=["start"];for(let o=0;o<n.length;o++){let s=n[o],r=[];for(let l=0;l<s.length;l++){let c=s[l],d=""+o+l;r.push(d),e[d]={node:c,lastCount:0},a[d]={};for(let h=0;h<i.length;h++){let p=i[h];e[p]&&e[p].node.mode===c.mode?(a[p][d]=ve(e[p].lastCount+c.length,c.mode)-ve(e[p].lastCount,c.mode),e[p].lastCount+=c.length):(e[p]&&(e[p].lastCount=c.length),a[p][d]=ve(c.length,c.mode)+4+_.getCharCountIndicator(c.mode,t))}}i=r}for(let o=0;o<i.length;o++)a[i[o]].end=0;return{map:a,table:e}}function Ua(n,t){let e,a=_.getBestModeForData(n);if(e=_.from(t,a),e!==_.BYTE&&e.bit<a.bit)throw new Error('"'+n+'" cannot be encoded with mode '+_.toString(e)+`.
 Suggested mode is: `+_.toString(a));switch(e===_.KANJI&&!Xt.isKanjiModeEnabled()&&(e=_.BYTE),e){case _.NUMERIC:return new $a(n);case _.ALPHANUMERIC:return new Va(n);case _.KANJI:return new Ja(n);case _.BYTE:return new ja(n)}}kt.fromArray=function(t){return t.reduce(function(e,a){return typeof a=="string"?e.push(Ua(a,null)):a.data&&e.push(Ua(a.data,a.mode)),e},[])};kt.fromString=function(t,e){let a=za(t,Xt.isKanjiModeEnabled()),i=En(a),o=Ln(i,e),s=kn.find_path(o.map,"start","end"),r=[];for(let l=1;l<s.length-1;l++)r.push(o.table[s[l]].node);return kt.fromArray(_n(r))};kt.rawSplit=function(t){return kt.fromArray(za(t,Xt.isKanjiModeEnabled()))}});var Ga=E(Wa=>{var ee=at(),qe=Ht(),xn=na(),Pn=sa(),An=ra(),In=da(),Ee=ua(),Le=me(),Bn=fa(),te=qa(),Nn=La(),Tn=nt(),ke=Ha();function On(n,t){let e=n.size,a=In.getPositions(t);for(let i=0;i<a.length;i++){let o=a[i][0],s=a[i][1];for(let r=-1;r<=7;r++)if(!(o+r<=-1||e<=o+r))for(let l=-1;l<=7;l++)s+l<=-1||e<=s+l||(r>=0&&r<=6&&(l===0||l===6)||l>=0&&l<=6&&(r===0||r===6)||r>=2&&r<=4&&l>=2&&l<=4?n.set(o+r,s+l,!0,!0):n.set(o+r,s+l,!1,!0))}}function Mn(n){let t=n.size;for(let e=8;e<t-8;e++){let a=e%2===0;n.set(e,6,a,!0),n.set(6,e,a,!0)}}function Fn(n,t){let e=An.getPositions(t);for(let a=0;a<e.length;a++){let i=e[a][0],o=e[a][1];for(let s=-2;s<=2;s++)for(let r=-2;r<=2;r++)s===-2||s===2||r===-2||r===2||s===0&&r===0?n.set(i+s,o+r,!0,!0):n.set(i+s,o+r,!1,!0)}}function Dn(n,t){let e=n.size,a=te.getEncodedBits(t),i,o,s;for(let r=0;r<18;r++)i=Math.floor(r/3),o=r%3+e-8-3,s=(a>>r&1)===1,n.set(i,o,s,!0),n.set(o,i,s,!0)}function _e(n,t,e){let a=n.size,i=Nn.getEncodedBits(t,e),o,s;for(o=0;o<15;o++)s=(i>>o&1)===1,o<6?n.set(o,8,s,!0):o<8?n.set(o+1,8,s,!0):n.set(a-15+o,8,s,!0),o<8?n.set(8,a-o-1,s,!0):o<9?n.set(8,15-o-1+1,s,!0):n.set(8,15-o-1,s,!0);n.set(a-8,8,1,!0)}function Rn(n,t){let e=n.size,a=-1,i=e-1,o=7,s=0;for(let r=e-1;r>0;r-=2)for(r===6&&r--;;){for(let l=0;l<2;l++)if(!n.isReserved(i,r-l)){let c=!1;s<t.length&&(c=(t[s]>>>o&1)===1),n.set(i,r-l,c),o--,o===-1&&(s++,o=7)}if(i+=a,i<0||e<=i){i-=a,a=-a;break}}}function Un(n,t,e){let a=new xn;e.forEach(function(l){a.put(l.mode.bit,4),a.put(l.getLength(),Tn.getCharCountIndicator(l.mode,n)),l.write(a)});let i=ee.getSymbolTotalCodewords(n),o=Le.getTotalCodewordsCount(n,t),s=(i-o)*8;for(a.getLengthInBits()+4<=s&&a.put(0,4);a.getLengthInBits()%8!==0;)a.putBit(0);let r=(s-a.getLengthInBits())/8;for(let l=0;l<r;l++)a.put(l%2?17:236,8);return $n(a,n,t)}function $n(n,t,e){let a=ee.getSymbolTotalCodewords(t),i=Le.getTotalCodewordsCount(t,e),o=a-i,s=Le.getBlocksCount(t,e),r=a%s,l=s-r,c=Math.floor(a/s),d=Math.floor(o/s),h=d+1,p=c-d,g=new Bn(p),k=0,I=new Array(s),K=new Array(s),x=0,D=new Uint8Array(n.buffer);for(let B=0;B<s;B++){let W=B<l?d:h;I[B]=D.slice(k,k+W),K[B]=g.encode(I[B]),k+=W,x=Math.max(x,W)}let M=new Uint8Array(a),R=0,V,F;for(V=0;V<x;V++)for(F=0;F<s;F++)V<I[F].length&&(M[R++]=I[F][V]);for(V=0;V<p;V++)for(F=0;F<s;F++)M[R++]=K[F][V];return M}function Vn(n,t,e,a){let i;if(Array.isArray(n))i=ke.fromArray(n);else if(typeof n=="string"){let c=t;if(!c){let d=ke.rawSplit(n);c=te.getBestVersionForData(d,e)}i=ke.fromString(n,c||40)}else throw new Error("Invalid data");let o=te.getBestVersionForData(i,e);if(!o)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=o;else if(t<o)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+o+`.
`);let s=Un(t,e,i),r=ee.getSymbolSize(t),l=new Pn(r);return On(l,t),Mn(l),Fn(l,t),_e(l,e,0),t>=7&&Dn(l,t),Rn(l,s),isNaN(a)&&(a=Ee.getBestMask(l,_e.bind(null,l,e))),Ee.applyMask(a,l),_e(l,e,a),{modules:l,version:t,errorCorrectionLevel:e,maskPattern:a,segments:i}}Wa.create=function(t,e){if(typeof t=="undefined"||t==="")throw new Error("No input text");let a=qe.M,i,o;return typeof e!="undefined"&&(a=qe.from(e.errorCorrectionLevel,qe.M),i=te.from(e.version),o=Ee.from(e.maskPattern),e.toSJISFunc&&ee.setToSJISFunction(e.toSJISFunc)),Vn(t,i,a,o)}});var xe=E(mt=>{function Ka(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let t=n.slice().replace("#","").split("");if(t.length<3||t.length===5||t.length>8)throw new Error("Invalid hex color: "+n);(t.length===3||t.length===4)&&(t=Array.prototype.concat.apply([],t.map(function(a){return[a,a]}))),t.length===6&&t.push("F","F");let e=parseInt(t.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:e&255,hex:"#"+t.slice(0,6).join("")}}mt.getOptions=function(t){t||(t={}),t.color||(t.color={});let e=typeof t.margin=="undefined"||t.margin===null||t.margin<0?4:t.margin,a=t.width&&t.width>=21?t.width:void 0,i=t.scale||4;return{width:a,scale:a?4:i,margin:e,color:{dark:Ka(t.color.dark||"#000000ff"),light:Ka(t.color.light||"#ffffffff")},type:t.type,rendererOpts:t.rendererOpts||{}}};mt.getScale=function(t,e){return e.width&&e.width>=t+e.margin*2?e.width/(t+e.margin*2):e.scale};mt.getImageWidth=function(t,e){let a=mt.getScale(t,e);return Math.floor((t+e.margin*2)*a)};mt.qrToImageData=function(t,e,a){let i=e.modules.size,o=e.modules.data,s=mt.getScale(i,a),r=Math.floor((i+a.margin*2)*s),l=a.margin*s,c=[a.color.light,a.color.dark];for(let d=0;d<r;d++)for(let h=0;h<r;h++){let p=(d*r+h)*4,g=a.color.light;if(d>=l&&h>=l&&d<r-l&&h<r-l){let k=Math.floor((d-l)/s),I=Math.floor((h-l)/s);g=c[o[k*i+I]?1:0]}t[p++]=g.r,t[p++]=g.g,t[p++]=g.b,t[p]=g.a}}});var Ya=E(ae=>{var Pe=xe();function jn(n,t,e){n.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=e,t.width=e,t.style.height=e+"px",t.style.width=e+"px"}function Jn(){try{return document.createElement("canvas")}catch(n){throw new Error("You need to specify a canvas element")}}ae.render=function(t,e,a){let i=a,o=e;typeof i=="undefined"&&(!e||!e.getContext)&&(i=e,e=void 0),e||(o=Jn()),i=Pe.getOptions(i);let s=Pe.getImageWidth(t.modules.size,i),r=o.getContext("2d"),l=r.createImageData(s,s);return Pe.qrToImageData(l.data,t,i),jn(r,o,s),r.putImageData(l,0,0),o};ae.renderToDataURL=function(t,e,a){let i=a;typeof i=="undefined"&&(!e||!e.getContext)&&(i=e,e=void 0),i||(i={});let o=ae.render(t,e,i),s=i.type||"image/png",r=i.rendererOpts||{};return o.toDataURL(s,r.quality)}});var Xa=E(Qa=>{var zn=xe();function Za(n,t){let e=n.a/255,a=t+'="'+n.hex+'"';return e<1?a+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':a}function Ae(n,t,e){let a=n+t;return typeof e!="undefined"&&(a+=" "+e),a}function Hn(n,t,e){let a="",i=0,o=!1,s=0;for(let r=0;r<n.length;r++){let l=Math.floor(r%t),c=Math.floor(r/t);!l&&!o&&(o=!0),n[r]?(s++,r>0&&l>0&&n[r-1]||(a+=o?Ae("M",l+e,.5+c+e):Ae("m",i,0),i=0,o=!1),l+1<t&&n[r+1]||(a+=Ae("h",s),s=0)):i++}return a}Qa.render=function(t,e,a){let i=zn.getOptions(e),o=t.modules.size,s=t.modules.data,r=o+i.margin*2,l=i.color.light.a?"<path "+Za(i.color.light,"fill")+' d="M0 0h'+r+"v"+r+'H0z"/>':"",c="<path "+Za(i.color.dark,"stroke")+' d="'+Hn(s,o,i.margin)+'"/>',d='viewBox="0 0 '+r+" "+r+'"',p='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+d+' shape-rendering="crispEdges">'+l+c+`</svg>
`;return typeof a=="function"&&a(null,p),p}});var ei=E(Ft=>{var Wn=ea(),Ie=Ga(),ti=Ya(),Gn=Xa();function Be(n,t,e,a,i){let o=[].slice.call(arguments,1),s=o.length,r=typeof o[s-1]=="function";if(!r&&!Wn())throw new Error("Callback required as last argument");if(r){if(s<2)throw new Error("Too few arguments provided");s===2?(i=e,e=t,t=a=void 0):s===3&&(t.getContext&&typeof i=="undefined"?(i=a,a=void 0):(i=a,a=e,e=t,t=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(e=t,t=a=void 0):s===2&&!t.getContext&&(a=e,e=t,t=void 0),new Promise(function(l,c){try{let d=Ie.create(e,a);l(n(d,t,a))}catch(d){c(d)}})}try{let l=Ie.create(e,a);i(null,n(l,t,a))}catch(l){i(l)}}Ft.create=Ie.create;Ft.toCanvas=Be.bind(null,ti.render);Ft.toDataURL=Be.bind(null,ti.renderToDataURL);Ft.toString=Be.bind(null,function(n,t,e){return Gn.render(n,e)})});var $t={NP_MOBILE_APP:"ap_",TRACKING:"tr_",BUSINESS_CABINET:"bc_",EXT_ACQUIRING:"va_"};function Ci(){return["/wallet","/payout"].includes(window.location.pathname)||window.location.pathname.includes("financial-services")||window.channel==="np_app"?$t.NP_MOBILE_APP:window.channel==="business_cabinet"?$t.BUSINESS_CABINET:window.channel==="np_site"?$t.TRACKING:$t.EXT_ACQUIRING}function vi(n,t={}){window.dataLayer&&window.dataLayer.push(j(N({},t),{event:`${Ci()}${n}`}))}var S=vi;function qi(n,t={}){let{method:e,body:a,query:i,signal:o}=t,s=ki(i);return fetch(`${n}?${s}`,{method:e||"GET",body:JSON.stringify(a),headers:{"Content-Type":"application/json"},signal:o})}function ki(n){let t=new URLSearchParams(window.location.search),e=t.get("theme")||"",a=t.get("lang")||"",i=t.get("appearance")||"";return Object.entries(j(N({},n),{theme:e,lang:a,appearance:i})).reduce((s,r)=>{let[l,c]=r;return c?s.length>0?s+=`&${l}=${c}`:s+=`${l}=${c}`:s},"")}var y=qi;function f(n){let t=document.querySelector(".tabs");t.querySelector(".tab[data-active=true]").dataset.active=!1,t.querySelector(`.tab[data-tab=${n}]`).dataset.active=!0}function yt(){document.querySelector(".overlay").dataset.display="flex"}function J(){document.querySelector(".overlay").dataset.display=""}function se(){document.getElementById("app").style.overflow="hidden",document.querySelector(".skeleton-general").dataset.display="flex"}function U(){document.getElementById("app").style.overflow="",document.querySelector(".skeleton-general").dataset.display=""}function G(n){return n?n.split("/").reverse().join("").trim():""}function P(n,t=!0){let e=(n||"").replace(/\D/g,"");return e&&t&&(e=`+${e}`),e}function ft(n){let t=new Date(n),e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate();return i<10&&(i="0"+i),a<10&&(a="0"+a),`${i}.${a}.${e}`}function b(n=0,t={}){let{hideZeroCoins:e=!1,asNumber:a=!1}=t,i=new BigNumber(typeof n=="string"?n.replace(/\s/g,"").replace(",","."):n).toFixed(2,2);if(e){let[o,s]=i.split(".");["00","0"].includes(s)&&(i=o)}return a?i=new BigNumber(i).toNumber():i=i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "),i}function je(n,t){n.dataset.time=t,n.textContent=t;let e=setInterval(()=>n.textContent=n.dataset.time-=1,1e3),a=setTimeout(()=>clearInterval(e),t*1e3);n.dataset.intervalId=e,n.dataset.timeoutId=a}function Z(n,t=180){let e=n.querySelector(".resend"),a=n.querySelector(".timer"),i=a.textContent.replace(/[-\d:]/g,"").trim();$e(e),e.disabled=!0,e.dataset.status="go",e.dataset.time=t,a.textContent=`${i} ${Ve(t)}`;let o=setInterval(()=>a.textContent=`${i} ${Ve(e.dataset.time-=1)}`,1e3),s=setTimeout($e,t*1e3,e);e.dataset.intervalId=o,e.dataset.timeoutId=s}function $e(n){clearInterval(n.dataset.intervalId),clearTimeout(n.dataset.timeoutId),n.dataset.status="stop",n.disabled=!1}function Ve(n){let t=Math.floor(n/60),e=n%60,a=t<10?`0${t}`:t,i=e<10?`0${e}`:e;return`${a}:${i}`}function T(n,t="success",e=5e3){let a=document.querySelector(".snackbar"),i=a.querySelector(".message"),o=$(n);a.classList.add("visible"),a.dataset.type=t,i.textContent=o,setTimeout(_i,e)}function _i(){let n=document.querySelector(".snackbar"),t=n.querySelector(".message");n.classList.remove("visible"),setTimeout(()=>{n.dataset.type="",t.textContent=""},1e3)}function $(n){return window.translations[n]}function Vt(n,t){let e=null;return(...a)=>{window.clearTimeout(e),e=window.setTimeout(()=>n.apply(null,a),t)}}function gt(n){return n!=null&&n.startsWith(4)?`/public/assets/img/${window.isDark?"visa-white":"visa"}.svg`:n!=null&&n.startsWith(5)?"/public/assets/img/mastercard.svg":""}function w(n,t=null,e=!1){if(!e){let{code:a,isTaslink:i=!1,pan:o=""}=n||{},s=new URLSearchParams(window.location.search);s.delete("prev"),s.append("prev",window.location.pathname),s.append("error_code",a||"default_error_description"),["/charity","/money-box/","/instant","/walet","/result"].some(r=>window.location.pathname.includes(r))||(s.append("internal_sid",s.get("sid")),s.delete("sid")),i&&s.append("is_taslink",!0),o&&s.append("pan",o),window.location.replace(`/result?${s.toString()}`)}t&&y("/fe-log",{method:"POST",body:{error:t.message,stack:t.stack}}).catch(()=>null)}document.addEventListener("DOMContentLoaded",()=>{var r;Ei(),Ii(),window.self!==window.top&&document.querySelector(".page-content").classList.add("render-in-frame");let n=document.querySelectorAll(".modal-mask"),t=document.querySelectorAll(".modal-mask .close"),e=document.querySelectorAll("input[name=pan]"),a=document.querySelectorAll("input[name=expire]"),i=document.getElementById("online-support-modal"),o=document.querySelector(".online-support"),s=document.querySelectorAll(".footer");(r=window.location.search)!=null&&r.includes("appearance=dark")&&(window.isDark=!0),n.forEach(l=>l.addEventListener("click",c=>c.target===l?l.dataset.display="":null)),t.forEach(l=>l.addEventListener("click",c=>c.target.closest(".modal-mask").dataset.display="")),e.forEach(l=>{l.addEventListener("input",Li),l.addEventListener("input",xi)}),a.forEach(l=>{l.addEventListener("input",Pi),l.addEventListener("input",Ai)}),o==null||o.addEventListener("click",()=>i.dataset.display="flex"),s==null||s.forEach((l,c)=>{let d=document.querySelector(`#about-novapay-modal${c?`._${c}`:""}`),h=document.querySelector(`#about-credits-modal${c?`._${c}`:""}`),p=l.querySelector(".about-novapay");p==null||p.addEventListener("click",()=>{let g=window.location.pathname==="/financial-services/credits"?h:d;g.dataset.display="flex",S("proplatezhi_novapay")})})});function Ei(){let n=document.querySelectorAll("[mask]"),t={lazy:!1},e={"capitalize-first":(a,i)=>i._value.length?a:a.toUpperCase(),"capitalize-all":a=>a.toUpperCase()};window.masks=new Map,n.forEach(a=>{let i=a.getAttribute("mask"),o={};try{o=JSON.parse(a.getAttribute("mask-options"))||{}}catch(c){o={}}e[a.getAttribute("mask-options-prepare")]&&(o.prepare=e[a.getAttribute("mask-options-prepare")]),i==="Number"?i=Number:i==="Date"?(i=Date,o.max=new Date):i.includes("regex")&&(i=new RegExp(i.split(" - ")[1]));let r=`${a.closest("form").classList[0]}-${a.getAttribute("name")}`,l=new IMask(a,N(N({mask:i},t),o));window.masks.set(r,l),["instant-form-payer_phone"].includes(r)&&a.focus()})}function Li(n){let t=n.currentTarget;t.parentElement.querySelector("img.provider").src=gt(t.value)}function xi(n){var e;let t=n.currentTarget;t.value.length>=19&&((e=t.closest("form").expire)==null||e.focus())}function Pi(n){var e;let t=n.currentTarget;t.value.length>=5&&((e=t.closest("form").cvv)==null||e.focus())}function Ai(n){let t=n.currentTarget,e=document.querySelector(".expire-warning");if(t.value.length>=5){let[a,i]=t.value.split("/"),o=new Date(`20${i}-${a}-01`),s=new Date("2022-01-01");o.setMonth(o.getMonth()+1),o<new Date&&o>s?e.dataset.display="":e.dataset.display="none"}else e.dataset.display="none"}function Ii(){let n=document.querySelector("form.add-card");if(n){let t=[n.pan,n.expire,n.name],e=n.querySelector(".actions .submit");n.addEventListener("reset",()=>e.disabled=!0),t.forEach(a=>a.addEventListener("input",()=>{let i=n.pan.value.length===19&&n.expire.value.length===5&&n.name.value.length;e.disabled=!i}))}}var Lt=class{constructor({button:t,payCallback:e,errorCallback:a,checkCallback:i=()=>{}}={}){this.button=t||document.querySelector(".actions .buttons .apple-pay .apple-pay-button"),this.payCallback=e,this.errorCallback=a,this.checkCallback=i}checkPossibilityToPay(t=null){return m(this,null,function*(){try{this.checkCallback(),(yield window.ApplePaySession.canMakePaymentsWithActiveCard("merchant.ua.novapay"))?this.button.addEventListener("click",t||(()=>this.submitPay())):(T("apple_pay_no_cards","error"),this.errorCallback())}catch(e){w({},e,!0)}})}submitPay(){yt();let t={currencyCode:"UAH",countryCode:"UA",total:{label:window.productsLabel,amount:String(window.newAmount||window.amount)},merchantCapabilities:["supports3DS"],supportedNetworks:["masterCard","visa"]};S("oplata_click_oplatit",{payment_option:"apple_pay"});let e=new window.ApplePaySession(1,t);e.onvalidatemerchant=a=>Lt.submitApplePayValidateMerchant(a,e),e.onpaymentauthorized=a=>this.payCallback(JSON.stringify(a.payment.token),e),e.oncancel=J,e.begin()}static submitApplePayValidateMerchant(t,e){return m(this,null,function*(){try{let a={validationUrl:t.validationURL},i=yield y("/api/apple-pay-validate-merchant",{method:"POST",body:a}),o=yield i.json();if(!i.ok){w({code:o.code}),J();return}e.completeMerchantValidation(o)}catch(a){w({},a)}})}},jt=Lt;var re=class{constructor({payCallback:t,container:e,checkCallback:a=()=>{}}={}){this.container=e||document.querySelector(".actions .buttons .google-pay"),this.payCallback=t,this.checkCallback=a,this.paymentsClient=null,this.baseRequest={apiVersion:2,apiVersionMinor:0},this.baseCardPaymentMethod={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["MASTERCARD","VISA"]}},this.cardPaymentMethod=Object.assign({},this.baseCardPaymentMethod,{tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:"taslink",gatewayMerchantId:"000000020000001"}}})}checkPossibilityToPay(t=null){return m(this,null,function*(){try{let e=this.getPaymentsClient(),a=this.getIsReadyToPayRequest(),{result:i}=yield e.isReadyToPay(a);i&&!this.container.children.length&&(this.addPayButton(t),this.checkCallback())}catch(e){w({},e,!0)}})}getPaymentsClient(){if(this.paymentsClient===null){let t=["e-com.novapay.ua","online.novapay.ua"].includes(window.location.hostname)?"PRODUCTION":"TEST";this.paymentsClient=new google.payments.api.PaymentsClient({environment:t})}return this.paymentsClient}getIsReadyToPayRequest(){return Object.assign({},this.baseRequest,{allowedPaymentMethods:[this.baseCardPaymentMethod]})}addPayButton(t=null){let a=this.getPaymentsClient().createButton({buttonSizeMode:"fill",buttonType:"plain",buttonColor:window.isDark?"white":"black",onClick:t||(()=>this.submitPay()),buttonLocale:window.lang});this.container.appendChild(a)}submitPay(){return m(this,null,function*(){try{yt();let t=this.getPaymentsClient(),e=this.getPaymentDataRequest();S("oplata_click_oplatit",{payment_option:"google_pay"});let a=yield t.loadPaymentData(e),i=window.btoa(a.paymentMethodData.tokenizationData.token);this.payCallback(i)}catch(t){t.statusCode!=="CANCELED"&&w({},t),J()}})}getPaymentDataRequest(){let t=Object.assign({},this.baseRequest);return t.allowedPaymentMethods=[this.cardPaymentMethod],t.transactionInfo={countryCode:"UA",currencyCode:"UAH",totalPriceStatus:"FINAL",totalPrice:String(window.newAmount||window.amount)},t.merchantInfo={merchantId:"BCR2DN6TZOI5JOTU",merchantName:"NovaPay"},t}},Jt=re;var Je={},Bi={getItem:n=>Je[n]||null,setItem:(n,t)=>Je[n]=t};function ze(n){try{return n?window.localStorage:window.sessionStorage}catch(t){return Bi}}function Ni(n,t=!1){return ze(t).getItem(n)}function Ti(n,t,e=!1){return ze(e).setItem(n,t)}var u={getItem:Ni,setItem:Ti};var He=[".submit",".turn-off-mit"];function C(...n){n.forEach(t=>{t&&(t.querySelectorAll(".np-input").forEach(e=>e.classList.remove("error")),t.querySelectorAll(".error-text").forEach(e=>e.textContent=""))})}function L(n,...t){let e=Oi(n);t.forEach(a=>{a&&e.forEach(([i,o])=>{if(i){let s=a[i]||a.querySelector(`input[data-alt-name='${i}']`);s&&(s.closest(".np-input").classList.add("error"),s.nextElementSibling.textContent=o)}})})}function v(n){n.querySelectorAll("input").forEach(t=>t.disabled=!0),n.querySelectorAll(".np-input").forEach(t=>t.classList.add("disabled")),He.forEach(t=>{let e=n.querySelector(t);e&&(e.classList.add("loading"),e.disabled=!0)})}function q(n){n.querySelectorAll("input").forEach(t=>t.disabled=!1),n.querySelectorAll(".np-input").forEach(t=>t.classList.remove("disabled")),He.forEach(t=>{n.querySelector(t)&&(n.querySelector(t).classList.remove("loading"),n.querySelector(t).disabled=!1)})}function z(n){n.reset(),n.querySelectorAll("input").forEach(t=>{let e=window.masks.get(`${n.classList[0]}-${t.getAttribute("name")}`);e&&(e.updateValue(),e.updateControl())}),C(n)}function Oi(n){return Object.entries(n.reduce((t,e)=>{let a=e.instancePath.replace("/","");return t[a]=e.message,t},{}))}function tt(n,t=!1){let e=[...n.querySelectorAll("input")].map(({value:a})=>a).join("");return t&&!e&&(e=void 0),e}function et(n){let t=n.querySelector(".submit"),e=n.querySelectorAll("input");e.forEach(a=>{a.addEventListener("keyup",()=>setTimeout(()=>t.disabled=[...e].map(({value:i})=>i).join("").length!==e.length,25)),a.addEventListener("keyup",i=>{var r,l;let{target:o,key:s}=i;/[0-9]/.test(s)&&o.value?(r=o.nextSibling)==null||r.focus():s==="Backspace"?(l=o.previousSibling)==null||l.focus():o.value=""})})}var le=class{constructor(t={}){this.tabs={payOnCredit:document.querySelector(".pay-on-credit"),calculateLimit:document.querySelector(".calculate-limit"),changeFullName:document.querySelector(".change-full-name")},this.extra=t}init(){if(this.tabs.payOnCredit){let t=this.tabs.payOnCredit.querySelector(".actions .back"),e=this.tabs.payOnCredit.querySelector(".actions .calculate-limit-button"),a=this.tabs.payOnCredit.querySelector("#about-effective-rate-modal"),i=this.tabs.payOnCredit.querySelector(".effective-rate-info");t.addEventListener("click",()=>this.extra.isSeparatePage?window.close():f("payment")),e.addEventListener("click",()=>{this.fillClientData(),f("calculate-limit")}),i.addEventListener("click",()=>a.dataset.display="flex")}if(this.tabs.calculateLimit){let t=this.tabs.calculateLimit.querySelector("#social-status-modal"),e=t.querySelectorAll(".np-checkbox"),a=this.tabs.calculateLimit.querySelector(".terms input"),i=this.tabs.calculateLimit.querySelector(".full-name"),o=this.tabs.calculateLimit.querySelector(".item.social-status"),s=this.tabs.calculateLimit.querySelector(".submit"),r=this.tabs.calculateLimit.querySelectorAll(".passport-switch .switch-tab");i.addEventListener("click",()=>{C(this.tabs.changeFullName),f("change-full-name")}),o.addEventListener("click",()=>t.dataset.display="flex"),e.forEach(l=>l.addEventListener("change",()=>this.changeSocialStatusCheckbox())),a.addEventListener("change",()=>a.checked?s.disabled=!1:s.disabled=!0),r.forEach(l=>l.addEventListener("click",c=>this.clickPassportSwitchTab(c))),this.tabs.calculateLimit.addEventListener("submit",l=>this.submitCalculateLimit(l))}this.tabs.changeFullName&&this.tabs.changeFullName.querySelector(".change").addEventListener("click",()=>this.saveChangeFullName())}goToPayOnCredit(t){return m(this,null,function*(){this.init();let e=JSON.parse(u.getItem("credits-client-prepared",!0));e?this.tabs.payOnCredit.dataset.hasLimit=!0:this.tabs.payOnCredit.dataset.hasLimit=!1,yield this.checkCreditLimit(j(N({},e),{amount:window.amount}),t)})}checkCreditLimit(t,e){return m(this,null,function*(){this.extra.isSeparatePage||(e.disabled=!0,e.classList.add("loading"));let a=t.taxpayer_id?"/api/financial-services/credits/calculate-limit":"/api/financial-services/credits/calculate-draft-credit",i=yield y(a,{method:"POST",body:t});this.extra.isSeparatePage?U():(e.disabled=!1,e.classList.remove("loading"));let o=yield i.json();if(!i.ok)return T("default_error_description","error");this.submitCalculateLimitCallback(o)})}submitCalculateLimit(t){return m(this,null,function*(){t.preventDefault(),v(this.tabs.calculateLimit),C(this.tabs.calculateLimit),this.tabs.calculateLimit.querySelector(".full-name").classList.remove("error");let e=this.tabs.calculateLimit.querySelector(".item.passport .inputs").dataset.type==="id-card",a={amount:window.amount,phone:window.phone,taxpayer_id:this.tabs.calculateLimit.taxpayer_id.value,first_name:this.tabs.calculateLimit.first_name.value,last_name:this.tabs.calculateLimit.last_name.value,patronymic:this.tabs.calculateLimit.patronymic.value,document_type:e?"biometric_passport":"passport",document_series:(this.tabs.calculateLimit.document_series.value||"").toUpperCase(),document_number:this.tabs.calculateLimit.document_number.value,monthly_income:this.tabs.calculateLimit.monthly_income.value,social_status:[],birth_date:(this.tabs.calculateLimit.birth_date.value||"").split(".").reverse().join("-")};this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked").forEach(s=>a.social_status.push(s.getAttribute("name")));let i=yield y("/api/financial-services/credits/calculate-limit",{method:"POST",body:a}),o=yield i.json();if(q(this.tabs.calculateLimit),!i.ok&&o.type==="validation"){L(o.errors,this.tabs.calculateLimit),o.errors.find(r=>["/first_name","/last_name","/patronymic"].includes(r.instancePath))&&this.tabs.calculateLimit.querySelector(".full-name").classList.add("error");return}else i.ok||(o.error=!0);this.tabs.payOnCredit.dataset.hasLimit=!0,this.saveClientData(),this.submitCalculateLimitCallback(o,!0)})}submitCalculateLimitCallback(t,e=!1){var i;if(this.tabs.payOnCredit.removeAttribute("data-result"),t.error&&!e&&!this.extra.isSeparatePage)return T("default_error_description","error");let a=(i=t.general)==null?void 0:i.limit;t.error?this.tabs.payOnCredit.dataset.result="error":[null,void 0].includes(a)&&this.tabs.payOnCredit.dataset.hasLimit!=="false"?this.tabs.payOnCredit.dataset.result="empty":a<1e3&&this.tabs.payOnCredit.dataset.hasLimit!=="false"&&(this.tabs.payOnCredit.dataset.result="small",this.tabs.payOnCredit.querySelector(".calculate-limit-result .small-limit .amount").textContent=b(a,{hideZeroCoins:!0})),u.setItem("credits-general",JSON.stringify(t.general||{})),u.setItem("credits-draft-credit",JSON.stringify(t.draftCredit||{})),t.error||(this.displayGeneralInfo(),this.changeSocialStatusCheckbox()),f("pay-on-credit")}displayGeneralInfo(){let{limit:t}=JSON.parse(u.getItem("credits-general"))||{},e=JSON.parse(u.getItem("credits-draft-credit"))||{};this.tabs.payOnCredit.querySelector(".limit-amount-container .amount").textContent=b(t,{hideZeroCoins:!0});let a=this.tabs.payOnCredit.querySelectorAll(".current-payment-details .detail .value"),i=e.initial_schedule.reduce((r,l)=>new BigNumber(r).plus(l.body).plus(l.commission).toNumber(),0),o=a[2].textContent.split(" ").length>1?a[2].textContent.split(" ")[1]:a[2].textContent.split(" ")[0];a[0].textContent=b(e.amount,{hideZeroCoins:!0}),a[1].textContent=b(e.monthly_load,{hideZeroCoins:!0}),a[2].textContent=`${e.months} ${o}`,a[3].textContent=b(new BigNumber(i).minus(e.amount).toNumber(),{hideZeroCoins:!0}),a[4].textContent=b(i,{hideZeroCoins:!0}),a[5].textContent=`${e.real_percent} %`;let s=this.tabs.payOnCredit.querySelector(".not-enough-limit-warning");s.dataset.display=window.amount>t?"flex":"none"}clickPassportSwitchTab(t){let e=t.currentTarget,a=e.dataset.tab==="2",i=a?e.previousElementSibling:e.nextElementSibling;e.dataset.active=!0,i.dataset.active=!1;let o=this.tabs.calculateLimit.querySelector(".item.passport .inputs"),s=window.masks.get(`${this.tabs.calculateLimit.classList[0]}-document_number`);a?(o.dataset.type=null,s.updateOptions({mask:"000000"}),this.tabs.calculateLimit.document_number.placeholder="123456"):(o.dataset.type="id-card",s.updateOptions({mask:"000000000"}),this.tabs.calculateLimit.document_number.placeholder="123456789",this.tabs.calculateLimit.document_series.value=null)}changeSocialStatusCheckbox(){let t=this.tabs.calculateLimit.querySelector(".item.social-status"),e=this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked");this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:not(:checked)").forEach(i=>e.length>=2?i.disabled=!0:i.disabled=!1);let a=[...e].map(i=>i.nextElementSibling.nextSibling.textContent).join(", ");t.querySelector(".text").textContent=a,e.length?t.classList.add("filled"):t.classList.remove("filled")}saveChangeFullName(){let t=$("min_2_chars"),a=[{name:"last_name",value:this.tabs.changeFullName.last_name.value},{name:"first_name",value:this.tabs.changeFullName.first_name.value}].reduce((o,s)=>(s.value.length>=2||o.push({instancePath:s.name,message:t}),o),[]);if(C(this.tabs.changeFullName),a.length)return L(a,this.tabs.changeFullName);let i=this.tabs.calculateLimit.querySelector(".full-name .value");this.tabs.calculateLimit.last_name.value=this.tabs.changeFullName.last_name.value,this.tabs.calculateLimit.first_name.value=this.tabs.changeFullName.first_name.value,this.tabs.calculateLimit.patronymic.value=this.tabs.changeFullName.patronymic.value,i.textContent=[this.tabs.changeFullName.last_name.value,this.tabs.changeFullName.first_name.value,this.tabs.changeFullName.patronymic.value].join(" "),f("calculate-limit")}saveClientData(){let t={last_name:this.tabs.changeFullName.last_name.value,first_name:this.tabs.changeFullName.first_name.value,patronymic:this.tabs.changeFullName.patronymic.value,taxpayer_id:this.tabs.calculateLimit.taxpayer_id.value,birth_date:this.tabs.calculateLimit.birth_date.value,document_series:this.tabs.calculateLimit.document_series.value,document_number:this.tabs.calculateLimit.document_number.value,monthly_income:this.tabs.calculateLimit.monthly_income.value,social_status:[]};this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked").forEach(a=>t.social_status.push(a.getAttribute("name"))),u.setItem("credits-client",JSON.stringify(t),!0);let e=this.tabs.calculateLimit.querySelector(".item.passport .inputs").dataset.type==="id-card";t.phone=window.phone,t.document_type=e?"biometric_passport":"passport",t.birth_date=t.birth_date.split(".").reverse().join("-"),u.setItem("credits-client-prepared",JSON.stringify(t),!0)}fillClientData(){let t=window.clientFullName||{};Object.entries(t).forEach(([e,a])=>{a&&(this.tabs.changeFullName[e].value=a)}),this.saveChangeFullName()}showErrorForSeparatePage(){let t=this.tabs.payOnCredit.querySelector(".actions .back"),e=this.tabs.payOnCredit.querySelector(".actions .calculate-limit-button");t.addEventListener("click",()=>window.close()),e.remove(),this.tabs.payOnCredit.dataset.result="error",setTimeout(U,500)}},zt=le;function We(n){let t=document.querySelector(".cards .cards-list"),e=t.querySelector("template");[...t.children].forEach(a=>a.classList.contains("card")&&a.remove()),n.sort(({main:a,type:i})=>a||i==="novapay"?-1:0).forEach(a=>{let i=e.content.cloneNode(!0);i.querySelector(".name").textContent=a.name,i.querySelector(".number").textContent=ce(a.pan_mask),i.querySelector("img.provider").src=gt(a.pan_mask),i.querySelector(".card").dataset.id=a.id,i.querySelector(".card").dataset.main=a.main,i.querySelector(".card").dataset.novapay=a.type==="novapay",t.insertBefore(i,t.querySelector(".add-card-button"))})}function xt(n,t,e=!1){[...n.children].forEach(a=>a.classList.contains("option")&&a.tagName==="DIV"&&a.remove()),t.forEach(a=>{let i;switch(a.paymentType){case"wallet":i=n.querySelector("template.card").content.cloneNode(!0),i.querySelector(".name").textContent=a.name,i.querySelector(".number").textContent=a.isFake?$("payment_in_app"):ce(a.pan_mask),i.querySelector("img.provider").src=gt(a.pan_mask),i.querySelector(".option").dataset.novapay=a.type==="novapay",i.querySelector(".option").dataset.id=a.id,i.querySelector(".option").dataset.paymentType="wallet",a.type==="novapay"&&i.querySelector(".option .bonus")&&Mi(i.querySelector(".option"));break;case"apple-pay":case"google-pay":i=n.querySelector("template.apple-google-pay").content.cloneNode(!0),i.querySelector(".name").textContent=a.paymentType==="apple-pay"?"Apple Pay":"Google Pay",i.querySelector("img").src=a.paymentType==="google-pay"&&window.isDark?"/public/assets/img/google-pay-dark.svg":`/public/assets/img/${a.paymentType}.svg`,i.querySelector(".option").dataset.paymentType=a.paymentType;break;case"manual":e&&(i=n.querySelector("template.manual").content.cloneNode(!0),i.querySelector(".option").dataset.paymentType=a.paymentType);break}i&&(e?n.appendChild(i):n.insertBefore(i,n.querySelector("form")))})}function Mi(n){var a;let t=!!(window.clientAccountStatusAndBonus.isBonusApplicable&&window.clientAccountStatusAndBonus.availableBonus),e=!!(t&&(window.clientAccountStatusAndBonus.isExists||!window.clientAccountStatusAndBonus.isAppInstalled));n.dataset.hasBonus=t,n.dataset.hasBonusAmount=e,n.querySelector(".bonus .with-amount .word-uah").textContent=e?b((a=window.clientAccountStatusAndBonus.availableBonus)==null?void 0:a.bonus_amount,{hideZeroCoins:!0}):""}function Ge(n,t){n.querySelector(".name").textContent=t.name,n.querySelector(".number").textContent=ce(t.pan_mask),n.querySelector("img.provider").src=gt(t.pan_mask),n.dataset.novapay=t.type==="novapay"}function ce(n){return n?`${n.slice(0,4)} ${n.slice(4,6)}  \u2022 \u2022 \u2022 \u2022  ${n.slice(-2)}`:""}function Ke(n){let t=document.getElementById("welcome-to-credits-slider"),e=null;function a(s){let r=document.createElement("div");return s.split(" ").forEach(c=>r.classList.add(c)),r}function i(){e=a("dots"),n.track.details.slides.forEach((s,r)=>{let l=a("dot");l.addEventListener("click",()=>n.moveToIdx(r)),e.appendChild(l)}),t.appendChild(e)}function o(){let s=n.track.details.rel;Array.from(e.children).forEach((r,l)=>l===s?r.classList.add("active"):r.classList.remove("active"))}n.on("created",()=>{i(),o()}),n.on("slideChanged",()=>o())}function Ye(n,t=!1){let e=document.querySelector(".credits-list .list .items"),a=JSON.parse(u.getItem("credits-client-prepared",!0))||{},i=t?["closed"]:["opened","closing"],o=!1;e.classList.remove("empty"),[...e.children].forEach(s=>s.classList.contains("credits-item")&&s.remove()),n.forEach(s=>{let{credit_id:r,amount:l,total_amount_to_pay:c,signed_at:d,status:h}=s;if(!i.includes(h))return;let p=e.querySelector(".credits-item-template").content.cloneNode(!0),g=p.querySelectorAll(".credits-item-description"),k=p.querySelector(".credits-item-repay");p.querySelector(".credits-item").dataset.id=r,p.querySelector(".credits-item-title .id").textContent=r,p.querySelector(".credits-item-title .amount-text").textContent=b(l,{hideZeroCoins:!0}),["opened","closing"].includes(h)?(g[0].querySelector(".value").textContent=b(c,{hideZeroCoins:!0}),g[1].querySelector(".value").textContent=ft(d),g[2].remove()):(g[0].remove(),g[1].remove(),k.remove()),p.querySelector(".credits-item").classList.add(h),e.appendChild(p),o=!0}),o||(e.classList.add("empty"),e.dataset.type=t?"closed":"opened",Object.keys(a).length||(e.dataset.type="description"))}var Q=class{constructor(t={}){this.container=document.querySelector(".payment-options"),this.modal=document.querySelector("#payment-options-modal"),this.paymentInstruction=document.querySelectorAll(".payment-instruction"),this.paymentInstructionLink=document.querySelectorAll(".payment-instruction .link"),this.tabs={payment:document.querySelector(".payment")},this.donationConfirmationModal=document.querySelector("#donation-confirmation-modal"),this.applePay=null,this.googlePay=null,this.payOnCredit=new zt,this.paymentUrl="/api/pay",this.extra=t,this.onDonateConfirmation=null}init(){if(this.applePay=new jt({payCallback:this.submitAppleGooglePay.bind(this),checkCallback:this.appleGooglePayCheckCallback.bind(this),errorCallback:()=>{window.isAllowApplePay=!1,this.detectPreferredPaymentOption()}}),this.googlePay=new Jt({payCallback:this.submitAppleGooglePay.bind(this),checkCallback:this.appleGooglePayCheckCallback.bind(this)}),window.hasAdditionalCharityBlock){let t=new URLSearchParams(window.location.search),e=parseFloat(t.get("Summ"))||0,a=document.querySelector(".suggestion .about-charity-icon"),i=document.getElementById("charity-modal"),o=document.querySelector(".suggestion form.donation"),s=document.querySelector(".suggestion .donation input"),r=document.querySelector(".suggestion .donation .np-input"),l=document.querySelector(".suggestion .donation .input-overlay"),c=document.querySelectorAll(".suggestion .items .item");e&&(o.amount.value=e,l.style.display="none",r.classList.remove("hidden"),s.focus(),this.changeAmount(null,e)),o==null||o.addEventListener("submit",d=>d.preventDefault()),a==null||a.addEventListener("click",()=>i.dataset.display="flex"),s.addEventListener("keyup",this.changeAmount.bind(this)),l.addEventListener("click",()=>{l.style.display="none",r.classList.remove("hidden"),s.focus()}),c.forEach(d=>d.addEventListener("click",this.selectAmount.bind(this))),s.addEventListener("focus",()=>{l.style.display="none"}),s.addEventListener("blur",()=>{s.value||(l.style.display="flex")})}if(this.tabs.payment){let t=this.tabs.payment.querySelector(".open-payment-options"),e=this.tabs.payment.querySelector("form.option[data-payment-type=manual]"),a=this.tabs.payment.querySelector(".terms input"),i=this.tabs.payment.querySelector(".actions .submit"),o=this.tabs.payment.querySelector(".pay-on-credit-button"),s=this.tabs.payment.querySelector(".pay-in-app"),r=this.tabs.payment.querySelector(".download-app"),l=this.tabs.payment.querySelector("#donation-confirmation-modal .np-button.confirm-donation"),c=this.tabs.payment.querySelectorAll("#donation-confirmation-modal .close");t==null||t.addEventListener("click",()=>this.modal.dataset.display="flex"),e.addEventListener("click",()=>this.changePaymentOption("manual")),e.addEventListener("submit",this.submitPay.bind(this)),a.addEventListener("change",()=>a.checked?i.disabled=!1:i.disabled=!0),o==null||o.addEventListener("click",()=>this.payOnCredit.goToPayOnCredit(o)),s==null||s.addEventListener("click",()=>!window.clientAccountStatusAndBonus.isAppInstalled&&window.clientAccountStatusAndBonus.isExists&&window.clientAccountStatusAndBonus.isActive?this.tabs.payment.querySelector("#download-app-modal").dataset.display="flex":this.navigateToApp()),r.addEventListener("click",()=>this.navigateToApp()),l&&l.addEventListener("click",()=>this.onDonateConfirmation()),c.forEach(d=>d.addEventListener("click",h=>{let p=document.querySelector(".suggestion .donation");if(p){let g=p.querySelector(".input-overlay");p.amount.value="",g.style.display="flex";let k=window.masks.get(`${p.classList[0]}-amount`);k&&(k.value="",k.updateValue(),k.updateControl())}return this.changeAmount(null,0)}))}this.extra.isPayout?this.paymentUrl="/api/payout":this.extra.isCharity&&(this.paymentUrl="/api/charity-payment"),this.autoDetectPreferredPaymentOption(),this.autoLoginForVerifiedClients()}navigateToApp(){var i,o;let t=Object.entries({acquiring_sid:new URLSearchParams(window.location.search).get("sid"),charity_amount:new BigNumber(((o=(i=this.tabs.payment.querySelector(".donation"))==null?void 0:i.amount)==null?void 0:o.value)||0).toNumber()}).reduce((s,[r,l])=>l?s+=`${s.length?"&":""}${r}=${l}`:s,""),e="?open_store=1&utm_source=payment&utm_medium=banner&utm_campaign=seamless",a=window.clientAccountStatusAndBonus.isAppInstalled?`novapay-mobile://transfer/payment/novaposhta/${t}`:`https://mobile.novapay.ua/app/transfer/payment/novaposhta/${t}${e}`;window.location.assign(a)}markSelectedOption(){let t=this.container.dataset.paymentType,e=this.container.querySelectorAll(".option[data-active=true]"),a=this.container.querySelectorAll(t==="wallet"?`.option[data-id='${this.container.dataset.id}']`:`.option[data-payment-type=${t}]`);e.forEach(i=>i.dataset.active=!1),a.forEach(i=>i.dataset.active=!0)}changePaymentOption(t,e=""){switch(t){case"apple-pay":{this.applePay.checkPossibilityToPay(this.handleDigitalWalletClick.bind(this,t));break}case"google-pay":{this.googlePay.checkPossibilityToPay(this.handleDigitalWalletClick.bind(this,t));break}case"wallet":{let i=JSON.parse(u.getItem("wallet-cards")).find(({id:o})=>o===parseInt(e));u.setItem("wallet-selected-card",JSON.stringify(i)),this.container.dataset.id=e,this.container.dataset.payInApp=i.type==="novapay"&&(window.clientAccountStatusAndBonus.isActive||i.isFake);break}}this.container.dataset.paymentType=t,this.modal.dataset.display="",this.togglePaymentInstruction(t,e),this.renderPaymentOptionsForMainAndModal(t),this.markSelectedOption()}submitPay(t){return m(this,null,function*(){t==null||t.preventDefault();let e=this.container.dataset.paymentType;if(window.location.pathname!=="/pay")return this.proceedWithPayment(e);let{parcelAmount:a,donationAmount:i}=window;if(!i){let o=this.tabs.payment.querySelector(".donation input");o&&(i=BigNumber(parseFloat(o.value)||0).toNumber())}if(this.donationConfirmationModal&&i>0){document.querySelector("#donation-amount").textContent=`${i.toFixed(2)}`,document.querySelector("#total-amount").textContent=`${(a+i).toFixed(2)}`,document.querySelector("#parcel-amount").textContent=`${a.toFixed(2)}`;let o=document.querySelector("#donation-confirmation-modal");o?(this.onDonateConfirmation=()=>this.proceedWithPayment(e),o.dataset.display="flex"):this.proceedWithPayment(e)}else this.proceedWithPayment(e)})}autoLoginForVerifiedClients(){return m(this,null,function*(){let t=[];if(window.phone&&window.isClientVerified){let e={phone:P(window.phone),authorize:{wallet:!0}},a=yield y("/api/check-otp",{method:"POST",body:e}),i=yield a.json();a.ok&&!i.errors&&(t=i.cards)}this.listCards(t),U()})}autoDetectPreferredPaymentOption(){var e,a;let t=(a=(e=this.container)==null?void 0:e.dataset)==null?void 0:a.paymentType;t==="apple-pay"?this.applePay.checkPossibilityToPay(this.handleDigitalWalletClick.bind(this,t)):t==="google-pay"&&this.googlePay.checkPossibilityToPay(this.handleDigitalWalletClick.bind(this,t)),t&&this.markSelectedOption()}detectPreferredPaymentOption(){var o;let t="manual",e=null,a=JSON.parse(u.getItem("wallet-cards"));window.clientAccountStatusAndBonus.isActive||(a==null?void 0:a.find(({type:s,isFake:r})=>s==="novapay"&&r))?(t="wallet",e=a.find(({type:s})=>s==="novapay").id):window.isAllowApplePay?t="apple-pay":window.isAllowGooglePay?t="google-pay":a!=null&&a.length&&(t="wallet",e=((o=a.find(({main:s})=>s))==null?void 0:o.id)||a[0].id),this.changePaymentOption(t,e)}static prepareCards(t){let e=t.filter(({type:a})=>!["novapay_business","money_box"].includes(a));return window.clientAccountStatusAndBonus.isAccountChecked&&window.clientAccountStatusAndBonus.isExists&&!window.clientAccountStatusAndBonus.isActive?e=e.filter(({type:a})=>a!=="novapay"):window.clientAccountStatusAndBonus.isAccountChecked&&!window.clientAccountStatusAndBonus.isExists&&window.isNovaposhta&&window.isNovaposhtaMobileApp&&e.push({id:-1,type:"novapay",isFake:!0,wallet_added_at:new Date().toISOString()}),e=e.sort((a,i)=>new Date(i.wallet_added_at)-new Date(a.wallet_added_at)),e}listCards(){return m(this,arguments,function*(t=[]){let e=Q.prepareCards(t);if(this.extra.isPayout){let a=this.tabs.payment.querySelector(".payout-only-card-no-cards");a&&(a.dataset.display=e.length?"":"flex")}u.setItem("wallet-cards",JSON.stringify(e)),u.setItem("wallet-selected-card",null),this.renderPaymentOptionsForMainAndModal(),this.detectPreferredPaymentOption(),f("payment")})}renderPaymentOptionsForMainAndModal(t){let a=[...JSON.parse(u.getItem("wallet-cards")).map(o=>j(N({},o),{paymentType:"wallet"})),window.isAllowApplePay?{paymentType:"apple-pay"}:null,window.isAllowGooglePay?{paymentType:"google-pay"}:null,{paymentType:"manual"}].filter(Boolean),i=[];switch(t){case"manual":case"apple-pay":case"google-pay":{i.push({paymentType:t});break}case"wallet":{let o=JSON.parse(u.getItem("wallet-selected-card"));i.push(j(N({},o),{paymentType:"wallet"}));break}}xt(this.modal.querySelector(".options"),a,!0),xt(this.container.querySelector(".main .options"),i),a.length>1&&(this.tabs.payment.querySelector(".open-payment-options").dataset.display="block"),t==="manual"?this.tabs.payment.querySelector("form.option[data-payment-type=manual]").dataset.display="flex":this.tabs.payment.querySelector("form.option[data-payment-type=manual]").dataset.display="",this.container.querySelectorAll(".main .option").forEach(o=>o.addEventListener("click",()=>o.dataset.paymentType==="manual"?null:this.modal.dataset.display="flex")),this.modal.querySelectorAll(".option").forEach(o=>{switch(o.dataset.paymentType){case"wallet":o.addEventListener("click",()=>this.changePaymentOption(o.dataset.paymentType,o.dataset.id));break;case"apple-pay":case"google-pay":case"manual":o.addEventListener("click",()=>this.changePaymentOption(o.dataset.paymentType));break}})}static disableCharityInteraction(){let t=document.querySelector(".suggestion .donation input"),e=document.querySelectorAll(".suggestion .items .item");t.disabled=!0,e.forEach(a=>a.classList.add("disabled"))}selectAmount(t,e=0){if(t&&t.currentTarget.classList.contains("disabled"))return;let a=new BigNumber(e||t.currentTarget.dataset.amount).toNumber(),i=document.querySelector(".suggestion .donation"),o=i.querySelector(".input-overlay");parseFloat(i.amount.value)===parseFloat(a)?(a=null,i.amount.value="",o.style.display="flex"):(i.amount.value=a,o.style.display="none");let s=window.masks.get(`${i.classList[0]}-amount`);s.updateValue(),s.updateControl(),this.changeAmount(null,a)}changeAmount(t,e=void 0){var s;let a=e===void 0?new BigNumber(t.currentTarget.value).toNumber():e,i=document.querySelectorAll(".suggestion .items .item"),o=[...i].reduce((r,l)=>j(N({},r),{[l.dataset.amount]:l}),{});if(i.forEach(r=>r.classList.remove("active")),o[a]&&o[a].classList.add("active"),this.paymentInstructionLink.length&&this.patchPaymentInstructionLink(a),(s=this.tabs.payment.querySelector(".details .product[data-is-charity=true]"))==null||s.remove(),a){let r=new BigNumber(window.amount).plus(a).toNumber();if(this.tabs.payment.querySelector(".details")){let l=this.tabs.payment.querySelector(".details template").content.cloneNode(!0);l.querySelector(".product").dataset.isCharity=!0,l.querySelector(".description").textContent=$("donation"),l.querySelector(".amount").textContent=b(a),this.tabs.payment.querySelector(".details .products").prepend(l),this.tabs.payment.querySelector(".details .amount").textContent=b(r)}window.newAmount=r}else this.tabs.payment.querySelector(".details")&&(this.tabs.payment.querySelector(".details .amount").textContent=b(window.amount)),window.newAmount=null;this.extra.isCharity&&this.tabs.payment.querySelectorAll(".actions .buttons button").forEach(l=>l.disabled=!a)}appleGooglePayCheckCallback(){if(this.extra.isCharity){let t=this.tabs.payment.querySelectorAll(".actions .buttons button"),e=document.querySelector(".suggestion .donation input"),a=new BigNumber(e.value).toNumber();t.forEach(i=>i.disabled=!a)}}static getPreparedQuery(){let t={},e=new URLSearchParams(window.location.search);return Object.entries({sid:"sid",source:"utm_source",show_close:"show_close"}).forEach(([a,i])=>{e.get(i)&&(t[a]=e.get(i))}),t}submitManual(){return m(this,null,function*(){var o,s,r,l;let t=this.tabs.payment.querySelector(".option[data-payment-type=manual]");v(this.tabs.payment),this.donationConfirmationModal&&v(this.donationConfirmationModal),C(t,this.extra.additionalValidationForm);let e={pan:(o=t.pan.value)==null?void 0:o.replace(/\s/g,""),expire:G((s=t.expire)==null?void 0:s.value),cvv:(r=t.cvv)==null?void 0:r.value};this.extra.customBodyBuilder&&(e=this.extra.customBodyBuilder(e)),S("oplata_click_oplatit",{payment_option:"one_time_card"});let a=yield y(this.paymentUrl,{method:"POST",body:e,query:Q.getPreparedQuery()}),i=yield a.json();if(q(this.tabs.payment),this.donationConfirmationModal&&q(this.donationConfirmationModal),!a.ok&&i.type==="validation")return!!e.amount&&Q.disableCharityInteraction(),this.showValidationErrorsAndCloseModal(i.errors,t,this.extra.additionalValidationForm);if(!a.ok)return w({code:i.code,isTaslink:(l=i.params)==null?void 0:l.isTaslink});if(i.redirectUrl)return window.location.replace(i.redirectUrl);this.extra.submitCallback&&this.extra.submitCallback(i)})}submitWallet(){return m(this,null,function*(){let t={walletCardId:parseInt(JSON.parse(u.getItem("wallet-selected-card")).id)};this.extra.customBodyBuilder&&(t=this.extra.customBodyBuilder(t)),v(this.tabs.payment),this.donationConfirmationModal&&v(this.donationConfirmationModal),C(this.extra.additionalValidationForm),S("oplata_click_oplatit",{payment_option:"wallet"});let e=yield y(this.paymentUrl,{method:"POST",body:t,query:Q.getPreparedQuery()}),a=yield e.json();if(q(this.tabs.payment),this.donationConfirmationModal&&q(this.donationConfirmationModal),!e.ok&&a.type==="validation"){if(this.extra.additionalValidationForm)this.showValidationErrorsAndCloseModal(a.errors,this.extra.additionalValidationForm);else{let i=a.errors[0].keyword==="validExpire"?"wrong_expire":"default_error_description";T(i,"error",1e4)}return}else if(!e.ok)return w({code:a.code});if(a.redirectUrl)return window.location.replace(a.redirectUrl);this.extra.submitCallback&&this.extra.submitCallback(a)})}submitAppleGooglePay(t,e=!1){return m(this,null,function*(){let a={[e?"appleData":"googleData"]:t};this.extra.customBodyBuilder&&(a=this.extra.customBodyBuilder(a)),C(this.extra.additionalValidationForm);let i=yield y(this.paymentUrl,{method:"POST",body:a,query:Q.getPreparedQuery()}),o=yield i.json();if(!i.ok&&o.type==="validation"){J(),this.showValidationErrorsAndCloseModal(o.errors,this.extra.additionalValidationForm);return}else if(!i.ok){J(),w({code:o.code});return}if(e&&e.completePayment(window.ApplePaySession.STATUS_SUCCESS),o.redirectUrl)return window.location.replace(o.redirectUrl);o.charityRedirectUrl&&J(),this.extra.submitCallback&&this.extra.submitCallback(o)})}proceedWithPayment(t){return m(this,null,function*(){switch(t){case"manual":this.submitManual();break;case"wallet":this.submitWallet();break}})}showValidationErrorsAndCloseModal(t,...e){L(t,...e),this.closeDonationConfirmationModal()}closeDonationConfirmationModal(){let t=document.querySelector("#donation-confirmation-modal");t&&(t.dataset.display="")}handleDigitalWalletClick(t){return m(this,null,function*(){if(window.location.pathname!=="/pay")return this.proceedWithDigitalPayment(t);let{parcelAmount:e,donationAmount:a}=window;if(!a){let i=this.tabs.payment.querySelector(".donation input");i&&(a=BigNumber(parseFloat(i.value)||0).toNumber())}if(this.donationConfirmationModal&&a>0){document.querySelector("#donation-amount").textContent=`${a.toFixed(2)}`,document.querySelector("#total-amount").textContent=`${(e+a).toFixed(2)}`,document.querySelector("#parcel-amount").textContent=`${e.toFixed(2)}`;let i=document.querySelector("#donation-confirmation-modal");i?(this.onDonateConfirmation=()=>this.proceedWithDigitalPayment(t),i.dataset.display="flex"):this.proceedWithDigitalPayment(t)}else this.proceedWithDigitalPayment(t)})}proceedWithDigitalPayment(t){t==="apple-pay"?this.applePay.submitPay():t==="google-pay"&&this.googlePay.submitPay()}togglePaymentInstruction(t,e=""){if(this.paymentInstruction.length&&(this.paymentInstruction.forEach(a=>a.classList.remove("visible")),t==="wallet")){let i=JSON.parse(u.getItem("wallet-cards")).find(({id:o})=>o===parseInt(e));["novapay","novapay_business"].includes(i.type)&&this.paymentInstruction.forEach(o=>o.classList.add("visible"))}}patchPaymentInstructionLink(t){this.paymentInstructionLink.forEach(e=>{let a=new URL(e.href);t?a.searchParams.has("draft_charity_amount")?a.searchParams.set("draft_charity_amount",t):a.searchParams.append("draft_charity_amount",t):a.searchParams.delete("draft_charity_amount"),e.href=a.pathname+a.search})}},bt=Q;document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/pay"){let n=new bt({customBodyBuilder:Fi,additionalValidationForm:document.querySelector(".donation")}),t=document.querySelector(".details");n.init(),window.innerWidth>=548&&Di();let e=document.querySelector(".info-icon");e&&e.addEventListener("click",()=>{document.querySelector("#charity-info-modal").dataset.display="flex"}),t==null||t.addEventListener("click",()=>{t.dataset.expanded=t.dataset.expanded?"":"true",S("oplata_click_detali")})}});function Fi(n){var e,a;let t=new BigNumber((a=(e=document.querySelector(".suggestion .donation"))==null?void 0:e.amount)==null?void 0:a.value).toNumber();return!window.hasAdditionalCharityBlock||!t?n:{instrument:n,amount:t}}function Di(){let n=document.querySelector(".footer"),t=document.querySelector(".actions"),e=document.querySelector(".payment-options");if(n&&e){let a=e.offsetWidth;if(window.innerWidth>=548){let i=n.offsetHeight,o=t.offsetHeight;n.style.position="fixed",n.style.bottom="0",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.zIndex="10",n.style.width=`${a}px`,t.style.position="fixed",t.style.bottom=`${i}px`,t.style.left="50%",t.style.transform="translateX(-50%)",t.style.zIndex="9",t.style.width=`${a}px`,t.style.paddingTop="0",e.style.paddingBottom=`${i+o}px`}}}document.addEventListener("DOMContentLoaded",()=>{window.location.pathname==="/payout"&&new bt({isPayout:!0,submitCallback:Ri}).init()});function Ri(n){return m(this,null,function*(){if(n.id&&f("payout-success"),yield new Promise(t=>setTimeout(t,2500)),window.location.search.includes("useRedirect=true")){let t=`https://my.novaposhta.ua/SecurePayment/payout?sid=${n.id}&Status=true&Cash2CardPAN=${n.pan}&Cash2CardAlias=`;return window.location.assign(t)}window.parent&&window.parent.postMessage(JSON.stringify(n),"*")})}var Pt=class{constructor(){this.tabs={phoneConfirmation:document.querySelector(".phone-confirmation"),otpConfirmation:document.querySelector(".otp-confirmation"),cards:document.querySelector(".cards"),mitSettings:document.querySelector(".mit-settings"),addCard:document.querySelector(".add-card")}}init(){if(this.tabs.phoneConfirmation&&this.tabs.phoneConfirmation.addEventListener("submit",this.submitPhoneConfirmation.bind(this)),this.tabs.otpConfirmation){let t=this.tabs.otpConfirmation.querySelector(".resend"),e=this.tabs.otpConfirmation.querySelector(".back"),a=this.tabs.otpConfirmation.querySelector(".submit");this.tabs.otpConfirmation.addEventListener("submit",this.submitOtpConfirmation.bind(this)),t.addEventListener("click",()=>{t.disabled||this.resendOtp()}),e.addEventListener("click",()=>{f("phone-confirmation"),z(this.tabs.otpConfirmation),a.disabled=!0}),et(this.tabs.otpConfirmation)}if(this.tabs.cards){let t=this.tabs.cards.querySelector(".change-account"),e=this.tabs.cards.querySelector(".app-promotion"),a=this.tabs.cards.querySelector(".mit-settings-banner"),i=this.tabs.cards.querySelector(".add-card-button"),o=document.querySelector("#remove-confirmation-modal .confirm");t.addEventListener("click",()=>{f("phone-confirmation"),this.tabs.phoneConfirmation.phone.focus()}),e.addEventListener("click",()=>document.querySelector("#app-promotion-modal").dataset.display="flex"),a.addEventListener("click",()=>{let s=JSON.parse(u.getItem("wallet-cards"));f(s.length?"mit-settings":"add-card")}),i.addEventListener("click",()=>f("add-card")),o.addEventListener("click",this.removeCard.bind(this))}if(this.tabs.mitSettings){let t=this.tabs.mitSettings.querySelector(".title .info"),e=this.tabs.mitSettings.querySelector(".selected-card"),a=this.tabs.mitSettings.querySelector(".switch input"),i=this.tabs.mitSettings.querySelectorAll(".back"),o=this.tabs.mitSettings.querySelector(".turn-off-mit"),s=this.tabs.mitSettings.querySelector(".submit");t.addEventListener("click",()=>{S("avtospisanie_info_icon"),document.querySelector("#about-mit-modal").dataset.display="flex"}),e.addEventListener("click",()=>this.tabs.mitSettings.querySelector("#payment-options-modal").dataset.display="flex"),a.addEventListener("change",r=>this.tabs.mitSettings.querySelector(".toggle-mit-without-confirmation-section").dataset.active=r.currentTarget.checked),i.forEach(r=>r.addEventListener("click",()=>{this.renderMitStatus(),f("cards")})),o.addEventListener("click",()=>this.setCardMain(!0)),s.addEventListener("click",()=>this.setCardMain())}if(this.tabs.addCard){let t=this.tabs.addCard.querySelector(".back"),e=this.tabs.addCard.querySelector(".terms input"),a=this.tabs.addCard.querySelector(".submit");t.addEventListener("click",()=>{f("cards"),z(this.tabs.addCard)}),e.addEventListener("change",()=>e.checked?a.disabled=!1:a.disabled=!0),this.tabs.addCard.addEventListener("submit",this.submitAddCard.bind(this))}window.isCardSaved&&(S("add_new_card_success"),setTimeout(()=>T("card_added"),750)),this.autoLoginForVerifiedClients()}autoLoginForVerifiedClients(){return m(this,null,function*(){var e,a;let t=(a=(e=this.tabs.phoneConfirmation)==null?void 0:e.phone)==null?void 0:a.value;if(t&&window.isClientVerified){let i={phone:P(t),authorize:{wallet:!0}},o=yield y("/api/check-otp",{method:"POST",body:i}),s=yield o.json();U(),o.ok&&!s.errors&&this.listCards(s)}else U()})}submitPhoneConfirmation(t){return m(this,null,function*(){t.preventDefault(),v(this.tabs.phoneConfirmation),C(this.tabs.phoneConfirmation);let e={phone:P(this.tabs.phoneConfirmation.phone.value)},a=yield y("/api/send-otp",{method:"POST",body:e}),i=yield a.json();if(q(this.tabs.phoneConfirmation),!a.ok&&i.type==="validation")return L(i.errors,this.tabs.phoneConfirmation);if(!a.ok){w({code:i.code}),S("lookupcode_failure_send");return}if(S("lookupcode_success_send"),i.skipOtp)return this.submitOtpConfirmation();Z(this.tabs.otpConfirmation),f("otp-confirmation"),this.tabs.otpConfirmation.querySelector(".otp-input input").focus()})}resendOtp(){return m(this,null,function*(){let t=this.tabs.otpConfirmation.querySelector(".resend"),e={phone:P(this.tabs.phoneConfirmation.phone.value)};t.disabled=!0;let a=yield y("/api/send-otp",{method:"POST",body:e}),i=yield a.json();if(!a.ok){w({code:i.code}),t.disabled=!1;return}S("lookupcode_click_resend"),Z(this.tabs.otpConfirmation)})}submitOtpConfirmation(t){return m(this,null,function*(){t==null||t.preventDefault(),v(this.tabs.otpConfirmation),C(this.tabs.otpConfirmation);let e={code:tt(this.tabs.otpConfirmation,!t),phone:P(this.tabs.phoneConfirmation.phone.value),authorize:{wallet:!0}},a=yield y("/api/check-otp",{method:"POST",body:e}),i=yield a.json();if(q(this.tabs.otpConfirmation),!a.ok&&i.type==="validation")return L(i.errors,this.tabs.otpConfirmation);if(a.ok){if(i.errors)return this.tabs.otpConfirmation.querySelector(".otp-input .error-text").textContent=i.errors.code}else return w({code:i.code});this.listCards(i),z(this.tabs.otpConfirmation)})}submitAddCard(t){return m(this,null,function*(){var o,s;t.preventDefault(),v(this.tabs.addCard),C(this.tabs.addCard);let e={pan:this.tabs.addCard.pan.value.replace(/\s/g,""),expire:G(this.tabs.addCard.expire.value),name:this.tabs.addCard.name.value.trim(),callbackPath:`/wallet?phone=${u.getItem("wallet-phone")}`},a=yield y("/api/add-card",{method:"POST",body:e}),i=yield a.json();if(q(this.tabs.addCard),!a.ok&&i.type==="validation"){L(i.errors,this.tabs.addCard),S("add_new_card_failure",{card_number:i.errors.find(r=>r.instancePath.includes("pan"))?"failure":"success",expiration_date:i.errors.find(r=>r.instancePath.includes("expire"))?"failure":"success",card_name:i.errors.find(r=>r.instancePath.includes("name"))?"failure":"success"});return}else if(!a.ok)return i.code==="CookieSessionExpiredError"?window.location.reload():w({code:((o=i.params)==null?void 0:o.code)||i.code,isTaslink:!!((s=i.params)!=null&&s.code)});z(this.tabs.addCard),i.redirectUrl?window.location.replace(i.redirectUrl):(se(),this.submitOtpConfirmation().finally(U))})}markSelectedOption(){let t=this.tabs.mitSettings.querySelector(".select-card-section"),e=this.tabs.mitSettings.querySelector("#payment-options-modal .options"),a=e.querySelectorAll(".option[data-active=true]"),i=e.querySelectorAll(`.option[data-id='${t.dataset.id}']`);a.forEach(o=>o.dataset.active=!1),i.forEach(o=>o.dataset.active=!0)}changeMitOptions(t){let a=JSON.parse(u.getItem("wallet-cards")).find(({id:i})=>i===parseInt(t));this.tabs.mitSettings.querySelector(".select-card-section").dataset.id=t,this.tabs.mitSettings.querySelector("#payment-options-modal").dataset.display="",Ge(this.tabs.mitSettings.querySelector(".selected-card .option"),a),this.tabs.mitSettings.querySelector(".actions .submit").disabled=!1,this.markSelectedOption()}renderMitStatus(){let e=JSON.parse(u.getItem("wallet-cards")).find(({main:a})=>a);e?(this.tabs.mitSettings.querySelector(".actions").dataset.type="active",this.tabs.cards.querySelector(".mit-settings-banner").dataset.status=e.mit_without_confirmation?"active-without":"active-with",this.changeMitOptions(e.id),this.tabs.mitSettings.querySelector(".switch input").checked=e.mit_without_confirmation):(this.tabs.mitSettings.querySelector(".select-card-section").removeAttribute("data-id"),this.tabs.mitSettings.querySelector(".switch input").checked=!1,this.tabs.mitSettings.querySelector(".actions .submit").disabled=!0,this.tabs.mitSettings.querySelector(".actions").dataset.type="inactive",this.tabs.cards.querySelector(".mit-settings-banner").dataset.status="inactive",this.markSelectedOption())}listCards(t){return m(this,null,function*(){let e=this.tabs.mitSettings.querySelector("#payment-options-modal .options"),a=(t.cards||[]).map(i=>j(N({},i),{paymentType:"wallet"})).filter(({type:i})=>!["novapay_business","money_box"].includes(i));u.setItem("wallet-cards",JSON.stringify(a)),t.phone&&(u.setItem("wallet-phone",t.phone),this.tabs.cards.querySelector(".change-account .phone").textContent=t.phone.replace(/(.{3})(.{3})(.{3})(.{2})(.{2})/,"$1 $2 $3 $4 $5")),We(a),xt(e,a),this.tabs.cards.querySelectorAll(".card .remove").forEach(i=>i.addEventListener("click",Pt.selectCardForRemoving)),e.querySelectorAll(".option").forEach(i=>i.addEventListener("click",()=>this.changeMitOptions(i.dataset.id))),this.renderMitStatus(),f("cards")})}setCardMain(t=!1){return m(this,null,function*(){v(this.tabs.mitSettings);let e=JSON.parse(u.getItem("wallet-cards")),a={cardId:t?0:parseInt(this.tabs.mitSettings.querySelector(".select-card-section").dataset.id),mitWithoutConfirmation:this.tabs.mitSettings.querySelector(".switch input").checked},i=yield y("/api/set-card-main",{method:"POST",body:a});if(q(this.tabs.mitSettings),!i.ok){let r=yield i.json();return r.code==="CookieSessionExpiredError"?window.location.reload():w({code:r.code})}this.listCards({cards:e.map(r=>j(N({},r),{main:a.cardId===r.id,mit_without_confirmation:a.cardId===r.id?a.mitWithoutConfirmation:!1}))}),S(t?"avtospisanie_off":"avtospisanie_on");let o="mit_was_set",s=e.find(({main:r})=>r);t?o="mit_was_canceled":s&&s.id!==a.cardId&&(o="mit_was_changed"),T(o)})}static selectCardForRemoving(t){let e=t.target.closest(".card"),i=JSON.parse(u.getItem("wallet-cards")).find(({id:o})=>o===parseInt(e.dataset.id));u.setItem("wallet-selected-card",JSON.stringify(i)),document.querySelector("#remove-confirmation-modal").dataset.display="flex"}removeCard(){return m(this,null,function*(){let t=JSON.parse(u.getItem("wallet-selected-card"));se();let e={id:parseInt(t.id)},a=yield y("/api/remove-card",{method:"POST",body:e});if(U(),!a.ok){let i=yield a.json();return i.code==="CookieSessionExpiredError"?window.location.reload():w({code:i.code})}document.querySelector("#remove-confirmation-modal").dataset.display="",S("delete_card"),this.listCards({cards:JSON.parse(u.getItem("wallet-cards")).filter(({id:i})=>i!==e.id)})})}},Ze=Pt;document.addEventListener("DOMContentLoaded",()=>{window.location.pathname==="/wallet"&&new Ze().init()});var rt=class{constructor(){this.MAX_RETRY_COUNT=180,this.tabs={result:document.querySelector(".result-container"),phoneConfirmation:document.querySelector(".phone-confirmation"),otpConfirmation:document.querySelector(".otp-confirmation"),addCard:document.querySelector(".add-card")}}init(){var t;if(this.tabs.result){let e=new URLSearchParams(window.location.search),a=this.tabs.result.querySelector(".with-copy"),i=this.tabs.result.querySelector(".back"),o=this.tabs.result.querySelector(".success-url a"),s=this.tabs.result.querySelector(".default-notification.save-card"),r=this.tabs.result.querySelector(".close-page"),l=document.querySelector("#save-card-modal");if(a==null||a.addEventListener("click",()=>{navigator.clipboard.writeText(a.textContent),T("copy_success")}),i==null||i.addEventListener("click",rt.backPrevPage),s==null||s.addEventListener("click",this.submitPhoneConfirmation.bind(this)),r==null||r.addEventListener("click",()=>{var c,d;window.parent&&window.parent.postMessage("close","*"),(d=(c=window.webkit)==null?void 0:c.messageHandlers)!=null&&d.close&&window.webkit.messageHandlers.close.postMessage("close"),window.close()}),(t=l==null?void 0:l.querySelector(".add"))==null||t.addEventListener("click",c=>{this.submitPhoneConfirmation(c),l.dataset.display=""}),window.isPaymentSuccess&&window.instrument==="one_time_card"&&!window.isMoneyBox){let c=e.get("internal_sid")||e.get("sid")||"",d=JSON.parse(u.getItem("successful-sids",!0))||[],h=[...new Set(d.concat(c))];u.setItem("successful-sids",JSON.stringify(h),!0),h.length%3===0?l.dataset.display="flex":h.length===4&&u.setItem("successful-sids",JSON.stringify([c]),!0)}if(window.isPaymentSuccess?(S("oplata_success",{payment_option:window.instrument}),rt.postSuccessMessage()):window.isPaymentProcessing?this.getPaymentResult():S("oplata_failure",{payment_option:window.instrument}),o!=null&&o.href&&typeof window.successRedirectTimeout=="number"){let c=o.querySelector(".countdown");je(c,window.successRedirectTimeout),setTimeout(()=>window.location.assign(o.href),window.successRedirectTimeout*1e3)}e.get("show_close")==="true"&&(r.dataset.display="block")}if(this.tabs.otpConfirmation){let e=this.tabs.otpConfirmation.querySelector(".resend"),a=this.tabs.otpConfirmation.querySelector(".back"),i=this.tabs.otpConfirmation.querySelector(".submit");this.tabs.otpConfirmation.addEventListener("submit",this.submitOtpConfirmation.bind(this)),e.addEventListener("click",()=>{e.disabled||this.resendOtp()}),a.addEventListener("click",()=>{f("result"),z(this.tabs.otpConfirmation),i.disabled=!0}),et(this.tabs.otpConfirmation)}if(this.tabs.addCard){let e=this.tabs.addCard.querySelector(".back"),a=this.tabs.addCard.querySelector(".terms input"),i=this.tabs.addCard.querySelector(".submit");e.addEventListener("click",()=>{f("result"),z(this.tabs.addCard)}),a.addEventListener("change",()=>a.checked?i.disabled=!1:i.disabled=!0),this.tabs.addCard.addEventListener("submit",this.submitAddCard.bind(this))}window.isCardSaved&&(S("add_new_card_success"),setTimeout(()=>T("card_added"),750))}static backPrevPage(){if(window.parent&&window.isMoneyBox)return window.parent.location.reload();let t=new URLSearchParams(window.location.search),e=t.get("internal_sid")||t.get("sid")||"",a=t.get("prev")||"/pay";t.delete("prev"),t.delete("sid"),t.delete("internal_sid"),t.delete("error_code"),t.delete("is_taslink"),t.delete("pan"),t.append("sid",e);let i=`${a}?${t.toString()}`;window.parent&&window.parent.postMessage("back_button_clicked","*"),window.location.replace(i)}static postSuccessMessage(){var t,e;window.parent&&window.parent.postMessage("payment_success","*"),(e=(t=window.webkit)==null?void 0:t.messageHandlers)!=null&&e.successPayment&&window.webkit.messageHandlers.successPayment.postMessage("payment_success")}getPaymentResult(t=1){return m(this,null,function*(){if(t>this.MAX_RETRY_COUNT)return;let e=new URLSearchParams(window.location.search).get("internal_sid")||"",a=yield y("/api/pay-result",{query:{sid:e}}),i=yield a.json();if(!a.ok||i.status==="failed")window.location.reload();else{if(["paid","holded","hold_confirmed"].includes(i.status)){rt.postSuccessMessage(),window.location.reload();return}setTimeout(()=>this.getPaymentResult(t+1),5e3)}})}submitPhoneConfirmation(t){return m(this,null,function*(){t.preventDefault(),yt(),v(this.tabs.phoneConfirmation),C(this.tabs.phoneConfirmation);let e={phone:P(this.tabs.phoneConfirmation.phone.value)},a=yield y("/api/send-otp",{method:"POST",body:e});J(),q(this.tabs.phoneConfirmation);let i=yield a.json();if(!a.ok&&i.type==="validation")return T("default_error_description","error");if(!a.ok){T("default_error_description","error"),S("lookupcode_failure_send");return}if(S("lookupcode_success_send"),i.skipOtp)return this.submitOtpConfirmation();Z(this.tabs.otpConfirmation),f("otp-confirmation"),this.tabs.otpConfirmation.querySelector(".otp-input input").focus()})}resendOtp(){return m(this,null,function*(){let t=this.tabs.otpConfirmation.querySelector(".resend");t.disabled=!0;let e={phone:P(this.tabs.phoneConfirmation.phone.value)};if(!(yield y("/api/send-otp",{method:"POST",body:e})).ok){T("default_error_description","error"),t.disabled=!1;return}S("lookupcode_click_resend"),Z(this.tabs.otpConfirmation)})}submitOtpConfirmation(t){return m(this,null,function*(){t==null||t.preventDefault(),v(this.tabs.otpConfirmation),C(this.tabs.otpConfirmation);let e={code:tt(this.tabs.otpConfirmation,!t),phone:P(this.tabs.phoneConfirmation.phone.value),authorize:{wallet:!0}},a=yield y("/api/check-otp",{method:"POST",body:e}),i=yield a.json();if(q(this.tabs.otpConfirmation),!a.ok&&i.type==="validation")return L(i.errors,this.tabs.otpConfirmation);if(a.ok){if(i.errors)return this.tabs.otpConfirmation.querySelector(".otp-input .error-text").textContent=i.errors.code}else return T("default_error_description","error");f("add-card"),z(this.tabs.otpConfirmation),this.tabs.addCard.querySelector(".card-form input").focus()})}submitAddCard(t){return m(this,null,function*(){t.preventDefault(),v(this.tabs.addCard),C(this.tabs.addCard);let e={pan:this.tabs.addCard.pan.value.replace(/\s/g,""),expire:G(this.tabs.addCard.expire.value),name:this.tabs.addCard.name.value.trim(),callbackPath:`/result?internal_sid=${new URLSearchParams(window.location.search).get("internal_sid")||""}`},a=yield y("/api/add-card",{method:"POST",body:e}),i=yield a.json();if(q(this.tabs.addCard),!a.ok&&i.type==="validation"){L(i.errors,this.tabs.addCard),S("add_new_card_failure",{card_number:i.errors.find(o=>o.instancePath.includes("pan"))?"failure":"success",expiration_date:i.errors.find(o=>o.instancePath.includes("expire"))?"failure":"success",card_name:i.errors.find(o=>o.instancePath.includes("name"))?"failure":"success"});return}else if(!a.ok)return T("default_error_description","error");i.redirectUrl?window.location.replace(i.redirectUrl):(this.tabs.result.querySelector(".default-notification.save-card").remove(),S("add_new_card_success"),T("card_added"),f("result"))})}},Qe=rt;document.addEventListener("DOMContentLoaded",()=>{window.location.pathname==="/result"&&new Qe().init()});document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/frames/init"){let n=document.querySelector(".create-order"),t=document.querySelector(".confirm-order");if(n){let e={searchPlaceholderValue:$("start_writing"),noResultsText:$("no_result"),noChoicesText:$("no_result"),itemSelectText:"",allowHTML:!1},a=n.querySelector(".submit"),i=n.querySelector(".city"),o=n.querySelector(".salepoint"),s=new Choices(i,e),r=new Choices(o,e);i.addEventListener("search",Vt(l=>Ui(s,l.detail.value),500)),i.addEventListener("choice",l=>{if(!l.detail.choice.value)return;let c=l.detail.choice.value,d=l.detail.choice.label;u.setItem("city",c),document.querySelector(".confirm-order .delivery").firstChild.textContent=d,$i(r,c)}),o.addEventListener("choice",l=>{if(!l.detail.choice.value)return;let c=l.detail.choice.value,d=l.detail.choice.label;u.setItem("salepoint",c),document.querySelector(".confirm-order .delivery").lastChild.textContent=d,a.disabled=!1}),n.addEventListener("submit",l=>Vi(l,n))}t&&n&&t.querySelector(".submit").addEventListener("click",a=>ji(a,n,t))}});function Ui(n,t=" "){return m(this,null,function*(){let e=new URLSearchParams(window.location.search).get("sid")||"",a=document.querySelector(".salepoint-form .loading-icon");a.dataset.type="city";let i=yield y("/api/cities",{query:{sid:e,query:t}}),o=yield i.json();if(a.dataset.type="",i.ok){if(o.success){let s=o.data.map(r=>({value:r.Ref,label:r.Description}));n.setChoices(s,"value","label",!0);return}}else return w({code:o.code})})}function $i(n,t){return m(this,null,function*(){let e=new URLSearchParams(window.location.search).get("sid")||"",a=document.querySelector(".salepoint-form .loading-icon");n.disable(),a.dataset.type="salepoint";let i=yield y("/api/salepoints",{query:{sid:e,city:t}}),o=yield i.json();if(a.dataset.type="",i.ok){if(o.success){let s=o.data.map(r=>({value:r.Ref,label:r.Description}));n.setChoices(s,"value","label",!0),n.enable();return}}else return w({code:o.code})})}function Vi(n,t){return m(this,null,function*(){n.preventDefault(),v(t),C(t);let e={session_id:new URLSearchParams(window.location.search).get("sid")||"",client_first_name:t.client_first_name.value,client_last_name:t.client_last_name.value,client_patronymic:t.client_patronymic.value,client_phone:P(t.client_phone.value),delivery:{recipient_city:u.getItem("city"),recipient_warehouse:u.getItem("salepoint")}},a=yield y("/api/prices",{method:"POST",body:e});q(t);let i=yield a.json();if(!a.ok&&i.type==="validation")return L(i.errors,t);if(!a.ok)return w({code:i.code});Ji(N(N({},e),i)),f("confirm-order")})}function ji(n,t,e){return m(this,null,function*(){n.preventDefault(),v(e);let a={session_id:new URLSearchParams(window.location.search).get("sid")||"",client_first_name:t.client_first_name.value,client_last_name:t.client_last_name.value,client_patronymic:t.client_patronymic.value,client_phone:P(t.client_phone.value),delivery:{recipient_city:u.getItem("city"),recipient_warehouse:u.getItem("salepoint")}},i=yield y("/api/process",{method:"POST",body:a});q(e);let o=yield i.json();if(i.ok){if(o.url)return window.location.assign(o.url)}else return w({code:o.code})})}function Ji(n){let t=document.querySelector(".confirm-order"),e=`${n.client_last_name} ${n.client_first_name} ${n.client_patronymic}`;t.querySelector(".recipient").firstChild.textContent=e,t.querySelector(".recipient").lastChild.textContent=n.client_phone,t.querySelector(".product-price").textContent=b(n.price),t.querySelector(".delivery-price").textContent=b(n.deliveryPrice),t.querySelector(".total").textContent=b(n.total)}document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/loan"){let n=document.querySelector(".bind-card"),t=document.querySelector(".verify-card");if(n){let e=n.querySelector(".terms input"),a=n.querySelector(".actions .submit");n.addEventListener("submit",i=>zi(i,n,t)),e.addEventListener("change",()=>e.checked?a.disabled=!1:a.disabled=!0)}t&&(t.addEventListener("submit",e=>Hi(e,t)),et(t))}});function zi(n,t,e){return m(this,null,function*(){var r,l,c,d;n.preventDefault(),v(t),C(t);let a=new URLSearchParams(window.location.search).get("sid")||"",i={pan:(r=t.pan.value)==null?void 0:r.replace(/\s/g,""),expire:G((l=t.expire)==null?void 0:l.value),cvv:(c=t.cvv)==null?void 0:c.value},o=yield y("/api/loan-bind-card",{method:"POST",body:i,query:{sid:a}});q(t);let s=yield o.json();if(!o.ok&&s.type==="validation")return L(s.errors,t);if(!o.ok)return w({code:s.code,isTaslink:(d=s.params)==null?void 0:d.isTaslink});f("verify-card"),e.querySelector(".otp-input input").focus()})}function Hi(n,t){return m(this,null,function*(){var o;n.preventDefault(),v(t),C(t);let e={code:tt(t)},a=yield y("/api/loan-verify-card",{method:"POST",body:e});q(t);let i=yield a.json();if(!a.ok&&i.type==="validation")return L(i.errors,t);if(!a.ok)return w({code:i.code,isTaslink:(o=i.params)==null?void 0:o.isTaslink});f("loan-success")})}document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/instant"||window.location.hostname==="online.novapay.ua"){let n=document.querySelectorAll(".toggler .toggle"),t=document.querySelector(".instant-form");Wi(),n.forEach(e=>e.addEventListener("click",Gi)),t&&(t.amount.addEventListener("keyup",Vt(()=>Ki(t),500)),t.addEventListener("submit",a=>Yi(a,t)))}});var wt=null;function Wi(){window.addEventListener("message",n=>{if(n.data==="payment_success"){let t=document.querySelector(".stepsline").children;t[1].classList.remove("active"),t[2].classList.add("active")}})}function Gi(n){let t=n.target.closest(".toggle").dataset.flow;document.querySelector(".instant").dataset.flow=t}function Ki(n){return m(this,null,function*(){let t=n.querySelector(".commission .amount"),e=n.querySelector(".total-amount .amount"),a=document.querySelector(".amount-part"),i=n.querySelector(".submit"),o={payer_phone:P(n.payer_phone.value),recipient_phone:P(n.recipient_phone.value),amount:parseFloat(n.amount.value)};if(!o.amount){t.textContent="0.00",e.textContent="0.00";return}a.dataset.status="loading",i.disabled=!0,wt&&wt.abort(),wt=new AbortController;let s=yield y("/api/instant-commission",{method:"POST",body:o,signal:wt.signal});a.dataset.status="",i.disabled=!1;let r=yield s.json();if(s.ok)r!=null&&r.amount&&(t.textContent=b(r.amount),e.textContent=b(new BigNumber(r.amount).plus(o.amount)),wt=null);else{w({code:r.code}),wt=null;return}})}function Yi(n,t){return m(this,null,function*(){n.preventDefault(),v(t),C(t);let{flow:e}=document.querySelector(".instant").dataset,a={payer_phone:P(t.payer_phone.value),amount:parseFloat(t.amount.value),referer:window.self!==window.top?document.referrer:document.location.href};e==="cash"?(a.payer_first_name=t.payer_first_name.value,a.payer_last_name=t.payer_last_name.value,a.payer_patronymic=t.payer_patronymic.value||null,a.recipient_phone=P(t.recipient_phone.value),a.recipient_first_name=t.recipient_first_name.value,a.recipient_last_name=t.recipient_last_name.value,a.recipient_patronymic=t.recipient_patronymic.value||null):e==="card"&&(a.pan=t.pan.value.replace(/\s/g,""));let i=yield y("/api/instant-payment",{method:"POST",body:a});q(t);let o=yield i.json();if(!i.ok&&o.type==="validation")return L(o.errors,t);if(!i.ok&&(o.code==="ExceededCardLimit"||o.code==="ExceededPhoneLimit"))return T(o.code,"error",1e4);if(i.ok){if(o.redirectUrl){let s=document.querySelector(".frames"),r=document.querySelector(".stepsline").children,l=s.firstChild;l.src=o.redirectUrl,s.dataset.display="block",r[0].classList.remove("active"),r[1].classList.add("active"),document.querySelector(".form-container").remove(),document.querySelector(".info-blocks").remove(),document.querySelector(".rights").remove()}}else return w({code:o.code})})}document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/charity"){let n=new bt({isCharity:!0,additionalValidationForm:document.querySelector(".donation"),customBodyBuilder:Qi,submitCallback:Xi});Zi(),n.init(),window.addEventListener("message",t=>{t.data==="back_button_clicked"&&window.location.reload()})}});function Zi(){document.querySelector("input[name=pan]").dataset.altName="instrument/pan",document.querySelector("input[name=expire]").dataset.altName="instrument/expire",document.querySelector("input[name=cvv]").dataset.altName="instrument/cvv"}function Qi(n){let t=new URLSearchParams(window.location.search),e=P(t.get("phone")),a=window.clientNpuid,i=t.get("OrderId");return{instrument:n,phone:e||void 0,amount:new BigNumber(document.querySelector(".suggestion .donation").amount.value).toNumber(),client_npuid:a||void 0,orderId:i||void 0}}function Xi(n){return m(this,null,function*(){if(n.charityRedirectUrl){let t=document.querySelector(".result-container"),e=document.querySelector(".text-container"),a=document.querySelector(".payment-container"),i=t.firstChild;i.src=n.charityRedirectUrl,t.dataset.display="flex",e.remove(),a.remove()}})}var lt=class{constructor(){oe(this,"creditsPaymentStatuses",{paid:"paid",pending:"pending",overdue:"overdue"});oe(this,"creditsStatuses",{opened:"opened",closing:"closing",closed:"closed"});this.tabs={phoneConfirmation:document.querySelector(".phone-confirmation"),otpCodeConfirm:document.querySelector(".otp-confirmation"),welcomeToCredits:document.querySelector(".welcome-to-credits"),creditsList:document.querySelector(".credits-list"),creditDetails:document.querySelector(".credit-details"),creditRepayment:document.querySelector(".credit-repayment"),calculateLimit:document.querySelector(".calculate-limit"),changeFullName:document.querySelector(".change-full-name"),calculateLimitResult:document.querySelector(".calculate-limit-result")}}init(){if(this.tabs.phoneConfirmation&&this.tabs.phoneConfirmation.addEventListener("submit",t=>this.submitPhoneConfirmation(t)),this.tabs.otpCodeConfirm){let t=this.tabs.otpCodeConfirm.querySelector(".back"),e=this.tabs.otpCodeConfirm.querySelector(".resend"),a=this.tabs.otpCodeConfirm.querySelector(".submit");this.tabs.otpCodeConfirm.addEventListener("submit",i=>this.submitOtpCodeConfirm(i)),t.addEventListener("click",()=>{f("phone-confirmation"),z(this.tabs.otpCodeConfirm),a.disabled=!0}),e.addEventListener("click",()=>{e.disabled||this.resendOtpCodeConfirm()}),et(this.tabs.otpCodeConfirm)}if(this.tabs.welcomeToCredits){let t=document.querySelector(".footer");this.tabs.welcomeToCredits.querySelector(".skip-welcome-to-credits-slider").addEventListener("click",()=>{t.dataset.display="none",f("credits-list")})}if(this.tabs.creditsList){let t=this.tabs.creditsList.querySelectorAll(".credits-switch .switch-tab"),e=this.tabs.creditsList.querySelector(".to-calculate-limit");t.forEach(a=>a.addEventListener("click",i=>this.clickCreditsSwitchTab(i))),e.addEventListener("click",()=>f("calculate-limit"))}if(this.tabs.creditDetails){let t=this.tabs.creditDetails.querySelector(".back"),e=this.tabs.creditDetails.querySelector(".submit"),a=this.tabs.creditDetails.querySelectorAll(".pay-another-amount");t.addEventListener("click",()=>{let i=u.getItem("credits-scroll-y-position");f("credits-list"),i&&window.scrollTo(0,i)}),e.addEventListener("click",i=>this.submitRepayment(null,i.currentTarget.dataset.amount)),a.forEach(i=>i.addEventListener("click",o=>this.showRepaymentTab(o.currentTarget.dataset.creditId)))}if(this.tabs.creditRepayment){let t=this.tabs.creditRepayment.querySelector(".back");this.tabs.creditRepayment.amount.addEventListener("keyup",e=>this.handleChangeRepaymentAmount(e)),t.addEventListener("click",()=>{var e,a;f("credits-list"),this.handleChangeRepaymentAmount(null,0),z(this.tabs.creditRepayment),(a=(e=this.tabs.creditRepayment.querySelector(".amount-options-multiple .value.active"))==null?void 0:e.classList)==null||a.remove("active")}),this.tabs.creditRepayment.addEventListener("submit",e=>this.submitRepayment(e))}if(this.tabs.calculateLimit){let t=this.tabs.calculateLimit.querySelector("#social-status-modal"),e=t.querySelectorAll(".np-checkbox"),a=this.tabs.calculateLimit.querySelector(".terms input"),i=this.tabs.calculateLimit.querySelector(".full-name"),o=this.tabs.calculateLimit.querySelector(".item.social-status"),s=this.tabs.calculateLimit.querySelector(".submit"),r=this.tabs.calculateLimit.querySelectorAll(".passport-switch .switch-tab");i.addEventListener("click",()=>{C(this.tabs.changeFullName),f("change-full-name")}),o.addEventListener("click",()=>t.dataset.display="flex"),e.forEach(l=>l.addEventListener("change",()=>this.changeSocialStatusCheckbox())),a.addEventListener("change",()=>a.checked?s.disabled=!1:s.disabled=!0),r.forEach(l=>l.addEventListener("click",c=>this.clickPassportSwitchTab(c))),this.tabs.calculateLimit.addEventListener("submit",l=>this.submitCalculateLimit(l))}this.tabs.changeFullName&&this.tabs.changeFullName.querySelector(".change").addEventListener("click",()=>this.saveChangeFullName()),this.tabs.calculateLimitResult&&this.tabs.calculateLimitResult.querySelectorAll(".close").forEach(e=>e.addEventListener("click",()=>f("credits-list"))),this.autoLoginForVerifiedClients()}submitPhoneConfirmation(t){return m(this,null,function*(){t.preventDefault(),v(this.tabs.phoneConfirmation),C(this.tabs.phoneConfirmation);let e={phone:P(this.tabs.phoneConfirmation.phone.value)},a=yield y("/api/send-otp",{method:"POST",body:e});q(this.tabs.phoneConfirmation);let i=yield a.json();if(!a.ok&&i.type==="validation"){L(i.errors,this.tabs.phoneConfirmation);return}else if(!a.ok){w({code:i.code}),S("lookupcode_failure_send");return}if(S("lookupcode_success_send"),u.setItem("credits-phone",i.phone),i.skipOtp)return this.submitOtpCodeConfirm();Z(this.tabs.otpCodeConfirm),f("otp-confirmation"),this.tabs.otpCodeConfirm.querySelector(".otp-input input").focus()})}submitOtpCodeConfirm(t){return m(this,null,function*(){t==null||t.preventDefault(),v(this.tabs.otpCodeConfirm),C(this.tabs.otpCodeConfirm);let e=JSON.parse(u.getItem("credits-client-prepared",!0)),a={code:tt(this.tabs.otpCodeConfirm,!t),phone:u.getItem("credits-phone"),authorize:{credits:!0},extra:e||{}},i=yield y("/api/check-otp",{method:"POST",body:a}),o=yield i.json();if(q(this.tabs.otpCodeConfirm),!i.ok&&o.type==="validation")return L(o.errors,this.tabs.otpCodeConfirm);if(i.ok){if(o.errors)return this.tabs.otpCodeConfirm.querySelector(".otp-input .error-text").textContent=o.errors.code}else return w({code:o.code});this.submitOtpCodeConfirmCallback(o),z(this.tabs.otpCodeConfirm)})}submitOtpCodeConfirmCallback(t){if(u.setItem("credits-general",JSON.stringify(t.general||{})),u.setItem("credits-items",JSON.stringify(t.credits||[])),this.fillClientData(),this.changeSocialStatusCheckbox(),this.listCredits(),this.displayGeneralInfo(),u.getItem("welcome-to-credits-displayed",!0))f("credits-list");else{let a=document.querySelector(".footer");a.dataset.display="none",f("welcome-to-credits"),u.setItem("welcome-to-credits-displayed",!0,!0),new KeenSlider("#welcome-to-credits-slider .keen-slider",{},[Ke])}}resendOtpCodeConfirm(){return m(this,null,function*(){let t=this.tabs.otpCodeConfirm.querySelector(".resend"),e={phone:u.getItem("credits-phone")};t.disabled=!0;let a=yield y("/api/send-otp",{method:"POST",body:e}),i=yield a.json();if(!a.ok){w({code:i.code}),t.disabled=!1;return}S("lookupcode_click_resend"),Z(this.tabs.otpCodeConfirm)})}saveChangeFullName(){let t=$("min_2_chars"),a=[{name:"last_name",value:this.tabs.changeFullName.last_name.value},{name:"first_name",value:this.tabs.changeFullName.first_name.value}].reduce((o,s)=>(s.value.length>=2||o.push({instancePath:s.name,message:t}),o),[]);if(C(this.tabs.changeFullName),a.length){L(a,this.tabs.changeFullName);return}let i=this.tabs.calculateLimit.querySelector(".full-name .value");this.tabs.calculateLimit.last_name.value=this.tabs.changeFullName.last_name.value,this.tabs.calculateLimit.first_name.value=this.tabs.changeFullName.first_name.value,this.tabs.calculateLimit.patronymic.value=this.tabs.changeFullName.patronymic.value,i.textContent=[this.tabs.changeFullName.last_name.value,this.tabs.changeFullName.first_name.value,this.tabs.changeFullName.patronymic.value].join(" "),f("calculate-limit")}submitCalculateLimit(t){return m(this,null,function*(){var s;t.preventDefault(),v(this.tabs.calculateLimit),C(this.tabs.calculateLimit),this.tabs.calculateLimit.querySelector(".full-name").classList.remove("error");let e=this.tabs.calculateLimit.querySelector(".item.passport .inputs").dataset.type==="id-card",a={phone:P(u.getItem("credits-phone")),taxpayer_id:this.tabs.calculateLimit.taxpayer_id.value,first_name:this.tabs.calculateLimit.first_name.value,last_name:this.tabs.calculateLimit.last_name.value,patronymic:this.tabs.calculateLimit.patronymic.value,document_type:e?"biometric_passport":"passport",document_series:(this.tabs.calculateLimit.document_series.value||"").toUpperCase(),document_number:this.tabs.calculateLimit.document_number.value,monthly_income:this.tabs.calculateLimit.monthly_income.value,social_status:[],birth_date:(this.tabs.calculateLimit.birth_date.value||"").split(".").reverse().join("-")};this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked").forEach(r=>a.social_status.push(r.getAttribute("name")));let i=yield y("/api/financial-services/credits/calculate-limit",{method:"POST",body:a});q(this.tabs.calculateLimit);let o=yield i.json();if(!i.ok&&o.type==="validation"){L(o.errors,this.tabs.calculateLimit),o.errors.find(l=>["/first_name","/last_name","/patronymic"].includes(l.instancePath))&&this.tabs.calculateLimit.querySelector(".full-name").classList.add("error");return}else if(!i.ok)this.tabs.calculateLimitResult.dataset.result="error";else{let r=(s=o==null?void 0:o.general)==null?void 0:s.limit;this.saveClientData(),this.tabs.calculateLimitResult.dataset.result=[null,void 0].includes(r)?"empty":"success",this.tabs.calculateLimitResult.querySelector(".success .title").textContent+=` ${b(r,{hideZeroCoins:!0})}`}u.setItem("credits-general",JSON.stringify(o.general||{})),u.setItem("credits-items",JSON.stringify(o.credits||[])),this.displayGeneralInfo(),this.listCredits(),f("calculate-limit-result")})}autoLoginForVerifiedClients(){return m(this,null,function*(){var e,a;let t=(a=(e=this.tabs.phoneConfirmation)==null?void 0:e.phone)==null?void 0:a.value;if(t&&window.isClientVerified){let i=JSON.parse(u.getItem("credits-client-prepared",!0)),o={phone:P(t),authorize:{credits:!0},extra:i||{}},s=yield y("/api/check-otp",{method:"POST",body:o}),r=yield s.json();if(!s.ok||r.errors)return U();u.setItem("credits-phone",o.phone),this.submitOtpCodeConfirmCallback(r),U()}else U()})}submitRepayment(t,e=0){return m(this,null,function*(){t==null||t.preventDefault();let a=parseFloat(e||this.tabs.creditRepayment.amount.value),i=JSON.parse(u.getItem("credits-selected-credit")),{total_amount_to_pay:o}=lt.getPreparedCreditData(i);if(C(this.tabs.creditRepayment),new BigNumber(a).gt(o))return L([{instancePath:"amount",message:$("amount_can_not_be_bigger_than_credit_amount")}],this.tabs.creditRepayment);v(this.tabs.creditRepayment),v(this.tabs.creditDetails);let s={amount:a,creditId:i.id,creditMedium:i.medium,phone:u.getItem("credits-phone"),purpose:{parcel:`\u041F\u043E\u0433\u0430\u0448\u0435\u043D\u043D\u044F \u043A\u0440\u0435\u0434\u0438\u0442\u0443 \u0437\u0430 \u0417\u0430\u044F\u0432\u043E\u044E \u2116${i.id} \u043F\u0440\u043E \u0432\u0438\u0434\u0430\u0447\u0443 \u0442\u0440\u0430\u043D\u0448\u0443. \u041F\u0406\u0411 ${i.last_name} ${i.first_name} ${i.patronymic||""} I\u041F\u041D ${i.taxpayer_id} \u0431\u0435\u0437 \u041F\u0414\u0412`,installment:`\u041F\u043E\u0433\u0430\u0448\u0435\u043D\u043D\u044F \u043A\u0440\u0435\u0434\u0438\u0442\u0443 \u0437\u0430 \u0417\u0430\u044F\u0432\u043E\u044E \u043F\u0440\u043E \u043F\u0440\u0438\u0454\u0434\u043D\u0430\u043D\u043D\u044F \u2116${i.id} \u0434\u043E \u0443\u043C\u043E\u0432 \u043F\u0443\u0431\u043B\u0456\u0447\u043D\u043E\u0433\u043E \u0434\u043E\u0433\u043E\u0432\u043E\u0440\u0443 \u043F\u0440\u043E \u0441\u043F\u043E\u0436\u0438\u0432\u0447\u0438\u0439 \u043A\u0440\u0435\u0434\u0438\u0442. \u041F\u0406\u0411 ${i.last_name} ${i.first_name} ${i.patronymic||""} I\u041F\u041D ${i.taxpayer_id} \u0431\u0435\u0437 \u041F\u0414\u0412`}[i.type]},r=yield y("/api/financial-services/credits/repayment",{method:"POST",body:s});q(this.tabs.creditRepayment),q(this.tabs.creditDetails);let l=yield r.json();if(!r.ok&&l.type==="validation"){L(l.errors,this.tabs.creditRepayment);return}else if(!r.ok){w({code:l.code});return}window.location.replace(l.redirectUrl)})}fillClientData(){let t=JSON.parse(u.getItem("credits-client",!0));!!Object.values(t||{}).filter(Boolean).length&&(this.tabs.changeFullName.last_name.value=t.last_name,this.tabs.changeFullName.first_name.value=t.first_name,this.tabs.changeFullName.patronymic.value=t.patronymic,this.tabs.calculateLimit.taxpayer_id.value=t.taxpayer_id,this.tabs.calculateLimit.birth_date.value=ft(t.birth_date),this.tabs.calculateLimit.document_series.value=t.document_series,this.tabs.calculateLimit.document_number.value=t.document_number,this.tabs.calculateLimit.monthly_income.value=t.monthly_income,t.social_status.forEach(a=>this.tabs.calculateLimit[a].checked=!0),this.tabs.changeFullName.last_name.disabled=!0,this.tabs.changeFullName.first_name.disabled=!0,this.tabs.changeFullName.patronymic.disabled=!0,this.tabs.calculateLimit.taxpayer_id.disabled=!0,this.tabs.calculateLimit.birth_date.disabled=!0,this.tabs.calculateLimit.document_series.disabled=!0,this.tabs.calculateLimit.document_number.disabled=!0,this.tabs.calculateLimit.monthly_income.disabled=!0,this.tabs.calculateLimit.querySelectorAll("#social-status-modal input").forEach(a=>a.disabled=!0)),this.saveChangeFullName()}saveClientData(){let t={last_name:this.tabs.changeFullName.last_name.value,first_name:this.tabs.changeFullName.first_name.value,patronymic:this.tabs.changeFullName.patronymic.value,taxpayer_id:this.tabs.calculateLimit.taxpayer_id.value,birth_date:this.tabs.calculateLimit.birth_date.value,document_series:this.tabs.calculateLimit.document_series.value,document_number:this.tabs.calculateLimit.document_number.value,monthly_income:this.tabs.calculateLimit.monthly_income.value,social_status:[]};this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked").forEach(a=>t.social_status.push(a.getAttribute("name"))),u.setItem("credits-client",JSON.stringify(t),!0);let e=this.tabs.calculateLimit.querySelector(".item.passport .inputs").dataset.type==="id-card";t.phone=P(u.getItem("credits-phone")),t.document_type=e?"biometric_passport":"passport",t.birth_date=t.birth_date.split(".").reverse().join("-"),u.setItem("credits-client-prepared",JSON.stringify(t),!0)}displayGeneralInfo(){let{limit:t,maxLimit:e}=JSON.parse(u.getItem("credits-general"))||{},a=JSON.parse(u.getItem("credits-items")),i=JSON.parse(u.getItem("credits-client-prepared",!0))||{},o=this.tabs.creditsList.querySelector(".limit-info"),s=o.querySelector(".description"),r=this.tabs.creditsList.querySelector(".calculate-limit-button-container"),l=this.tabs.creditsList.querySelector(".credits-switch");if(o.dataset.display="none",r.dataset.display="none",l.dataset.display="none",a!=null&&a.length&&(l.dataset.display="block"),Object.keys(i).length)if(o.dataset.display="block",[null,void 0].includes(t))o.querySelector(".option.no-limit").dataset.display="block";else{o.querySelector(".option:not(.no-limit)").dataset.display="block",s.querySelector(".left").textContent=b(Math.max(t,0),{hideZeroCoins:!0}),s.querySelector(".total").textContent=b(Math.max(e,0),{hideZeroCoins:!0});let c=e>0?Math.round(t/e*100):0;setTimeout(()=>o.querySelector(".bar").style.setProperty("--progress",`${c}%`),200)}else r.dataset.display="block"}listCredits(t=!1){let a=JSON.parse(u.getItem("credits-items")).map(i=>N(N({},i),lt.getPreparedCreditData(i)));Ye(a,t),this.tabs.creditsList.querySelectorAll(".credits-item[data-id]").forEach(i=>{i.addEventListener("click",()=>this.showCreditDetails(i.dataset.id))})}clickCreditsSwitchTab(t){let e=t.currentTarget,a=e.dataset.tab==="2",i=a?e.previousElementSibling:e.nextElementSibling;e.dataset.active=!0,i.dataset.active=!1,this.listCredits(a)}clickPassportSwitchTab(t){let e=t.currentTarget,a=e.dataset.tab==="2",i=a?e.previousElementSibling:e.nextElementSibling;e.dataset.active=!0,i.dataset.active=!1;let o=this.tabs.calculateLimit.querySelector(".item.passport .inputs"),s=window.masks.get(`${this.tabs.calculateLimit.classList[0]}-document_number`);a?(o.dataset.type=null,s.updateOptions({mask:"000000"}),this.tabs.calculateLimit.document_number.placeholder="123456"):(o.dataset.type="id-card",s.updateOptions({mask:"000000000"}),this.tabs.calculateLimit.document_number.placeholder="123456789",this.tabs.calculateLimit.document_series.value=null)}changeSocialStatusCheckbox(){let t=this.tabs.calculateLimit.querySelector(".item.social-status"),e=this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:checked");this.tabs.calculateLimit.querySelectorAll("#social-status-modal input:not(:checked)").forEach(i=>e.length>=2?i.disabled=!0:i.disabled=!1);let a=[...e].map(i=>i.nextElementSibling.nextSibling.textContent).join(", ");t.querySelector(".text").textContent=a,e.length?t.classList.add("filled"):t.classList.remove("filled")}static getPreparedCreditData(t){let{schedule:e,total_amount_to_pay:a}=t,i=e.findIndex(r=>{let l=new Date(r.billing_date),c=new Date,d=l.getDate()==c.getDate()&&l.getMonth()==c.getMonth()&&l.getFullYear()==c.getFullYear();return l>c||d}),o=i===-1;return{currentPeriod:e[o?e.length-1:i],total_amount_to_pay:a,isCreditTotallyOverdue:o}}showCreditDetails(t){var Me,Fe,De;let a=JSON.parse(u.getItem("credits-items")).find(Et=>Et.credit_id===parseInt(t)),{total_amount_to_pay:i,currentPeriod:o,isCreditTotallyOverdue:s}=lt.getPreparedCreditData(a),{payments:r}=this.getPreparedCreditData(a),{credit_id:l,amount:c,months:d,status:h,signed_at:p,real_percent:g,initial_schedule:k}=a,I=Math.max(new BigNumber(o.overdue_body).plus(o.overdue_commission).minus(o.paid_amount).toFixed(2),0);u.setItem("credits-selected-credit",JSON.stringify(a));let K=new BigNumber(c).plus(k.reduce((Et,ui)=>new BigNumber(Et).plus(ui.commission).toNumber(),0)).toFixed(2),x=new BigNumber(o.body).plus(o.commission).minus(o.paid_amount).toFixed(2);s?I=new BigNumber(I).plus(o.fine).toFixed(2):x=new BigNumber(x).plus(o.fine).toFixed(2);let D="pending";parseFloat(I)>0?(D="overdue",x=new BigNumber(x).plus(o.paid_amount).toFixed(2)):x=new BigNumber(x).plus(o.overdue_body).plus(o.overdue_commission).toFixed(2),parseFloat(x)<=0&&parseFloat(I)<=0&&(x=0,D="paid");let M=["opened","closing"].includes(h),R=this.tabs.creditDetails.querySelector(".left-info");R.querySelector(".left-to-pay .amount").textContent=b(i,{hideZeroCoins:!0});let F=this.tabs.creditDetails.querySelector("template").content.cloneNode(!0),B=F.querySelectorAll(".detail");B[0].querySelector(".value").textContent=l,B[1].querySelector(".value").textContent=ft(p);let W=B[2].querySelector(".value").textContent,Rt=W.split(" ").length>1?W.split(" ")[1]:W.split(" ")[0];B[2].querySelector(".value").textContent=`${d} ${Rt}`,B[3].dataset.status=h,B[4].querySelector(".value").textContent=b(c,{hideZeroCoins:!0}),B[5].querySelector(".value").textContent=b(I,{hideZeroCoins:!0}),parseFloat(I)<=0&&B[5].remove(),B[6].querySelector(".value").textContent=M?b(x,{hideZeroCoins:!0}):"0",B[7].querySelector(".value").textContent=b(K,{hideZeroCoins:!0}),B[8].querySelector(".value").textContent=b(k[0].commission,{hideZeroCoins:!0}),B[9].querySelector(".value").textContent=`${g} %`,h==="closed"&&((Me=F.querySelector(".credit-total-amount"))==null||Me.remove()),(Fe=this.tabs.creditDetails.querySelector(".details-list"))==null||Fe.remove(),this.tabs.creditDetails.insertBefore(F,this.tabs.creditDetails.querySelector(".np-button.back"));let Y=this.tabs.creditDetails.querySelector(".repayment-info"),st=this.tabs.creditDetails.querySelector(".paid-info"),pt=this.tabs.creditDetails.querySelector(".closing-notification"),oi=this.tabs.creditDetails.querySelector(".alert-overdue .amount"),_t=Y.querySelector(".info"),Te=_t.querySelector(".info-part.date .value"),si=Te.textContent.split(" ")[0],ri=this.tabs.creditDetails.querySelectorAll(".pay-another-amount"),Ut=this.tabs.creditDetails.querySelector(".submit"),li=Ut.querySelector(".text").textContent.split(" ")[0],ht=new BigNumber(x).toFixed(2);D==="paid"?ht=0:D==="overdue"&&(ht=new BigNumber(x).plus(I).toFixed(2)),ht=b(ht,{hideZeroCoins:!0}),Y.dataset.status=D,oi.textContent=b(I,{hideZeroCoins:!0}),_t.querySelector(".info-part.amount .value").textContent=b(x,{hideZeroCoins:!0}),Te.textContent=`${si} ${ft(o.billing_date)}`,ri.forEach(Et=>Et.dataset.creditId=t),Ut.querySelector(".text").textContent=`${li} ${ht}`,Ut.dataset.creditId=t,Ut.dataset.amount=b(ht,{hideZeroCoins:!0,asNumber:!0}),h==="closed"?(R.dataset.display="none",pt.dataset.display="none",Y.dataset.display="none",st.dataset.display="none"):h==="closing"?(R.dataset.display="block",pt.dataset.display="block",Y.dataset.display="none",st.dataset.display="none"):D==="paid"?(R.dataset.display="block",pt.dataset.display="none",Y.dataset.display="none",st.dataset.display="block"):(R.dataset.display="block",pt.dataset.display="none",Y.dataset.display="block",st.dataset.display="none"),D==="overdue"&&!parseFloat(x)?_t.dataset.display="none":_t.dataset.display="flex";let ci=Math.max(new BigNumber(100).minus(new BigNumber(i).dividedBy(c).multipliedBy(100)),0),Oe=R.querySelector(".bar");Oe.style.setProperty("--progress","0%"),setTimeout(()=>Oe.style.setProperty("--progress",`${ci}%`),200),u.setItem("credits-scroll-y-position",window.scrollY),f("credit-details"),window.scrollTo(0,0);let di=r.current-((De=r.fine)!=null?De:0)===0;r.fine&&di&&r.overdue&&(_t.dataset.display="none")}showRepaymentTab(t){let a=JSON.parse(u.getItem("credits-items")).find(i=>i.credit_id===parseInt(t));u.setItem("credits-selected-credit",JSON.stringify(a)),this.showRepaymentHotKeys(a),f("credit-repayment")}showRepaymentHotKeys(t){var k;let e=document.querySelector("template.hotKey"),a=e.content.querySelectorAll(".translate > .label"),{payments:i,paymentStatus:o,currentPeriodIndex:s}=this.getPreparedCreditData(t),r=(t==null?void 0:t.status)===this.creditsStatuses.opened&&o===this.creditsPaymentStatuses.paid,l=t==null?void 0:t.schedule[s+1],c=0;l&&(c=new BigNumber(l.body).plus(l.commission).toNumber());let d={MonthlyPayment:0,CurrentPayment:1,FullRepayment:2},h=i.current-((k=i.fine)!=null?k:0)===0,p=[{notShow:!r||c>t.total_amount_to_pay,amount:Math.ceil(c).toString(),label:a[d.MonthlyPayment].textContent},{notShow:(i==null?void 0:i.current)>=t.total_amount_to_pay||r||h&&(i==null?void 0:i.fine)&&(i==null?void 0:i.overdue),amount:Math.ceil(i.current).toString(),label:a[d.CurrentPayment].textContent},{amount:b(t.total_amount_to_pay,{decimals:2}),label:a[d.FullRepayment].textContent}],g=document.querySelector(".amount-options-multiple");p.filter(I=>!I.notShow).forEach(({amount:I,label:K})=>{let x=e.content.querySelector(".value").cloneNode(!0);x.dataset.amount=I;let D=x.querySelector(".amount"),M=x.querySelector(".label");D.textContent=I,M.textContent=K,x.addEventListener("click",R=>this.handleSelectRepaymentAmount(R)),g.appendChild(x)})}getPreparedCreditData(t){let{amount:e,schedule:a}=t,i=a.findIndex(h=>{let p=new Date(h.billing_date),g=new Date;return p.getFullYear()===g.getFullYear()&&p.getMonth()===g.getMonth()&&p.getDate()===g.getDate()||p>g}),o=i===-1;o&&(i=a.length-1);let s=a[i],r=new BigNumber(s.body).plus(s.commission),l=new BigNumber(s.overdue_body).plus(s.overdue_commission).minus(s.paid_amount);o?l=l.plus(s.fine):r=r.plus(s.fine),l.lt(0)&&(r=r.plus(l));let c=this.creditsPaymentStatuses.pending;l.gt(0)?c=this.creditsPaymentStatuses.overdue:r.lte(0)&&(c=this.creditsPaymentStatuses.paid);let d=r;return c===this.creditsPaymentStatuses.overdue?d=d.plus(l):c===this.creditsPaymentStatuses.paid&&(d=new BigNumber(0)),{paymentStatus:c,amount:e,currentPeriodIndex:i,payments:{current:Number(Math.max(r.toNumber(),0).toFixed(2)),overdue:Number(l.toFixed(2)),toPay:Number(Math.max(d.toNumber(),0).toFixed(2)),date:s.billing_date,fine:s.fine}}}handleChangeRepaymentAmount(t,e=null){let a=e!=null?e:parseFloat(t.currentTarget.value),i=this.tabs.creditRepayment.querySelector(".submit"),o=this.tabs.creditRepayment.querySelectorAll(".amount-options .value"),s=[...o].reduce((l,c)=>{let d=parseFloat(c.dataset.amount);return l[d]=c,l},{});o.forEach(l=>l.classList.remove("active")),s[a]&&s[a].classList.add("active");let r=i.querySelector(".text").textContent.split(" ")[0];a?(i.querySelector(".text").classList.add("word-uah"),i.querySelector(".text").textContent=`${r} ${b(a,{hideZeroCoins:!0})}`,i.disabled=!1):(i.querySelector(".text").classList.remove("word-uah"),i.querySelector(".text").textContent=r,i.disabled=!0)}handleSelectRepaymentAmount(t){var i;let e=parseFloat(((i=t.currentTarget.dataset)==null?void 0:i.amount)||t.currentTarget.textContent.replace(/\D/gm,""));this.tabs.creditRepayment.amount.value=e;let a=window.masks.get(`${this.tabs.creditRepayment.classList[0]}-amount`);a.updateValue(),a.updateControl(),this.handleChangeRepaymentAmount(null,e)}},Xe=lt;document.addEventListener("DOMContentLoaded",()=>{window.location.pathname==="/financial-services/credits"&&new Xe().init()});document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/financial-services/pay-on-credit"){let n=new zt({isSeparatePage:!0});parseFloat(window.amount)?n.goToPayOnCredit():n.showErrorForSeparatePage()}});var ai=Si(ei());var Kn=1,Yn=1e5,Zn=29999,Dt=class{constructor(){this.payUrl="/api/money-box-pay",this.applePay=null,this.googlePay=null,this.containers={general:document.querySelector(".general-container"),text:document.querySelector(".text-container"),payment:document.querySelector(".payment-container"),result:document.querySelector(".result-container")}}static setAltNames(){document.querySelector("input[name=pan]").dataset.altName="instrument/pan",document.querySelector("input[name=expire]").dataset.altName="instrument/expire",document.querySelector("input[name=cvv]").dataset.altName="instrument/cvv"}init(){let t=this.containers.general.dataset.type;if(this.applePay=new jt({payCallback:this.submitAppleGooglePay.bind(this),button:this.containers.payment.querySelector(".apple-pay .apple-pay-button"),errorCallback:()=>{window.isAllowApplePay=!1,this.containers.payment.querySelector(".apple-pay").remove()}}),this.googlePay=new Jt({payCallback:this.submitAppleGooglePay.bind(this),container:this.containers.payment.querySelector(".google-pay")}),window.isAllowApplePay?this.applePay.checkPossibilityToPay().then(()=>this.containers.payment.querySelector(".apple-pay button").disabled=t!=="fixed"):this.containers.payment.querySelector(".apple-pay").remove(),window.isAllowGooglePay?this.googlePay.checkPossibilityToPay().then(()=>this.containers.payment.querySelector(".google-pay button").disabled=t!=="fixed"):this.containers.payment.querySelector(".google-pay").remove(),this.containers.payment){let e=this.containers.payment.querySelector("form#manual-payment"),a=this.containers.payment.querySelector(".pay-by-card"),i=this.containers.payment.querySelector(".amount-input-form input"),o=this.containers.payment.querySelectorAll(".suggestion-amounts .item"),s=this.containers.payment.querySelector(".pay-in-app"),r=document.querySelector("#mobile-app-qr-modal"),l=r.querySelector(".qr"),c=this.containers.payment.querySelector("form#manual-payment"),d=c.querySelector(".terms input");document.querySelector(".amount-input-form").addEventListener("click",()=>i.focus()),window.isMobile&&document.body.addEventListener("click",p=>{p.target.closest("button, input, a, select, textarea")||i.focus()},{once:!0}),t==="fixed"?(i.disabled=!0,this.selectAmount(void 0,window.amount)):window.amount=null,a.addEventListener("click",()=>{a.dataset.display="none",e.dataset.display="block",this.validateAmount()}),i.addEventListener("input",this.amountInputHandler.bind(this)),o.forEach(p=>p.addEventListener("click",this.selectAmount.bind(this))),s.addEventListener("click",()=>{let{deeplink:p}=s.dataset,g=`${p}&amount=${i.value?i.value:0}`;window.isMobile?window.location.assign(g):(r.dataset.display="flex",ai.default.toDataURL(g).then(k=>l.src=k))}),c.addEventListener("submit",this.submitManual.bind(this)),d.addEventListener("change",this.validateAmount.bind(this)),c.addEventListener("input",this.validateAmount.bind(this)),this.setupCommentInput(),this.validateAmount()}Dt.setAltNames()}setupCommentInput(){let t=this.containers.payment.querySelector(".payment-comment"),e=t.querySelector("input"),a=t.querySelector(".counter"),i=+e.getAttribute("maxlength"),o=()=>{let s=e.value.length;a.innerText=`${s} / ${i}`,a.classList.toggle("error",s>=i)};e.addEventListener("input",o),o()}selectAmount(t,e=0){let a=new BigNumber(e||t.currentTarget.dataset.amount).toNumber(),i=this.containers.payment.querySelector(".amount-input-form");parseFloat(i.amount.value)===parseFloat(a)&&(a=null),i.amount.value=a;let o=window.masks.get(`${i.classList[0]}-amount`);o.updateValue(),o.updateControl(),this.changeAmount(a)}amountInputHandler(t){this.changeAmount(new BigNumber(t.currentTarget.value).toNumber())}changeAmount(t){let e=`${t}`;this.containers.payment.querySelectorAll(".suggestion-amounts .item").forEach(a=>{a.dataset.amount===e?a.classList.add("active"):a.classList.remove("active")}),window.amount=t||null,this.updatePostfixPosition(),this.validateAmount()}validateAmount(){var F,B,W,Rt,Y,st;let t=this.containers.payment.querySelector("form#manual-payment"),e=this.containers.payment.querySelector(".amount-input-form input"),a=this.containers.payment.querySelector(".apple-pay button"),i=this.containers.payment.querySelector(".google-pay button"),o=this.containers.payment.querySelector(".pay-by-card"),s=this.containers.payment.querySelector(".pay-in-app"),r=t.querySelector("button"),l=this.containers.payment.querySelector(".transfer-limits"),c=t.querySelector(".terms input"),d=(B=(F=t.pan.value)==null?void 0:F.replace(/\s/g,""))==null?void 0:B.slice(0,6),h=parseFloat(e.value),p=h&&h>Yn,g=h&&h>Zn,k=h<Kn||!h,I=((Rt=(W=t.pan.value)==null?void 0:W.replace(/\s/g,""))==null?void 0:Rt.length)===16&&((Y=t.cvv.value)==null?void 0:Y.length)===3&&((st=t.expire.value)==null?void 0:st.length)===5,K=(d==null?void 0:d.length)===6,x=K&&window.novapayCardBins.includes(d),D=x?p:g,M=[...l.children];M.forEach(pt=>pt.style.display="none"),p?M[0]&&(M[0].style.display="block"):g&&!x?K?M[3]&&(M[3].style.display="block"):M[1]&&(M[1].style.display="block"):k&&Number.isFinite(h)&&M[2]&&(M[2].style.display="block"),s&&(s.disabled=k);let R=!!(D||k);a&&(a.disabled=R),i&&(i.disabled=R);let V=!!(D||k);o&&(o.disabled=V),r&&(r.disabled=V||!I||!c.checked)}updatePostfixPosition(){let t=this.containers.payment.querySelector(".amount-input-form input"),{value:e}=t,a=this.containers.payment.querySelector(".amount-input-form .uah");t.style.width=`${(e.length?e.length:1)*21}px`,a.dataset.active=(e!==""&&Number.isFinite(+e)).toString()}sendPayment(t,e){return m(this,null,function*(){var p,g;let a=this.containers.payment.querySelector("form#manual-payment"),i=this.containers.payment.querySelector("form.amount-input-form"),o=this.containers.payment.querySelector(".transfer-limits"),[s,r,l,c]=o.children;v(this.containers.payment),C(a),i.classList.remove("error"),o.classList.remove("error");let d=yield y(this.payUrl,{method:"POST",body:{moneyBoxPublicId:window.location.pathname.split("/")[2],amount:parseFloat(i.amount.value),comment:(p=this.containers.payment.querySelector(".payment-comment input").value)==null?void 0:p.trim(),instrument:t}}),h=yield d.json();if(q(this.containers.payment),J(),!d.ok&&h.type==="validation")return h.errors.some(({instancePath:k})=>k.includes("amount"))&&(e?(o.classList.add("error"),i.amount.value||(s&&(s.style.display="none"),r&&(r.style.display="none"),l&&(l.style.display="block"),c&&(c.style.display="none"))):i.classList.add("error")),L(h.errors,a);if(!d.ok)return w({code:h.code,isTaslink:(g=h.params)==null?void 0:g.isTaslink});this.submitCallback(h.redirectUrl)})}submitManual(t){return m(this,null,function*(){var a,i,o;t.preventDefault();let e=this.containers.payment.querySelector("form#manual-payment");yield this.sendPayment({pan:(a=e.pan.value)==null?void 0:a.replace(/\s/g,""),expire:G((i=e.expire)==null?void 0:i.value),cvv:(o=e.cvv)==null?void 0:o.value},!0)})}submitAppleGooglePay(t,e=!1){return m(this,null,function*(){yield this.sendPayment({[e?"appleData":"googleData"]:t},!1)})}submitCallback(t){let e=this.containers.result.firstChild;e.src=t,this.containers.result.dataset.display="flex",this.containers.text.remove(),this.containers.payment.remove()}},ii=Dt;document.addEventListener("DOMContentLoaded",()=>{window.location.pathname.includes("/case/")&&new ii().init()});document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname==="/payment-instructions"){let n=document.querySelector(".back_to_pay_btn"),t=document.getElementById("pdf-canvas"),e=t.dataset.url;pdfjsLib.GlobalWorkerOptions.workerSrc="/public/assets/js/pdf.worker.mjs",pdfjsLib.getDocument(e).promise.then(a=>{a.getPage(1).then(i=>{let o=i.getViewport({scale:2});t.width=o.width,t.height=o.height;let r={canvasContext:t.getContext("2d"),viewport:o};i.render(r)})}),n==null||n.addEventListener("click",()=>{window.history.go(-1)})}});var Ne=class{constructor(){this.descriptionDefault=document.getElementById("description-default"),this.descriptionOTP=document.getElementById("description-otp"),this.securityMessage=document.querySelector(".security-message"),this.fixedBottomButton=document.querySelector(".fixed-bottom-button"),this.resendLink=document.getElementById("resend-link"),this.optTries=2,this.otp=document.querySelector(".otp"),this.otpContainer=document.querySelector(".otp-container"),this.otpSuccess=document.querySelector(".otp-success"),this.otpInput=document.querySelector(".otp-input-form"),this.continueButton=document.querySelector(".otp-continue-button"),this.redirectUrl=this.otpSuccess.dataset.redirectUrl,this.viewportHeight=window.innerHeight,this.status=null}init(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&window.addEventListener("resize",()=>this.handleResize),"OTPCredential"in window){let t=new AbortController;this.continueButton.addEventListener("click",()=>t.abort()),navigator.credentials.get({otp:{transport:["sms"]},signal:t.signal}).then(e=>{this.otpInput.value=e.code,this.checkOTP(this.otpInput.value)}).catch(e=>null)}this.resendLink.addEventListener("click",()=>this.resendOtp()),this.otpInput.addEventListener("input",t=>this.handleOTPInput(t.target)),this.continueButton.addEventListener("click",()=>this.checkOTP(this.otpInput.value)),this.getPaymentResult()}changeToOTPPage(){let t=window.phone;this.otpContainer.style.display="flex",this.descriptionDefault.style.display="none",this.descriptionOTP.style.display="flex",this.descriptionOTP.textContent+=` ${t}`,this.securityMessage.style.display="none",this.fixedBottomButton.style.display="block",this.startTimer(5*60)}startTimer(t){let e=t,a=this.otpContainer.querySelector(".timer"),i=this.otpContainer.querySelector(".timer-text");a.textContent=`${parseInt(e/60,10).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`,a.style.display="flex",i.style.display="flex";let o=setInterval(()=>{let s=parseInt(e/60,10),r=parseInt(e%60,10);a.textContent=`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`,--e<0&&(clearInterval(o),a.style.display="none",i.style.display="none",this.optTries?this.resendLink.style.display="flex":window.location.replace(this.redirectUrl))},1e3)}handleResize(){window.innerHeight<this.viewportHeight*.75?(this.fixedBottomButton.style.display="none",window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})):this.fixedBottomButton.style.display="block",this.viewportHeight=window.innerHeight}handleOTPInput(t){if(this.otpInput.classList.contains("error")){this.otpInput.classList.remove("error");let e=document.querySelector(".error-message");e.style.display="none",this.otpContainer.querySelector(".timer").style.display="flex",this.otpContainer.querySelector(".timer-text").style.display="flex"}t.value.length===4?this.continueButton.disabled=!1:this.continueButton.disabled=!0}showOtpSuccess(){this.otpSuccess.style.display="flex",this.otp.style.display="none",setTimeout(()=>window.location.replace(this.redirectUrl),1e3)}showErrorMessage(){this.otpContainer.querySelector(".timer").style.display="none",this.otpContainer.querySelector(".timer-text").style.display="none",this.resendLink.style.display="none";let t=document.querySelector(".error-message");t.style.display="flex",document.querySelector(".otp-input-form").classList.add("error")}resendOtp(){return m(this,null,function*(){let t=new URLSearchParams(window.location.search).get("sid")||"";yield y("/api/novapay-card-processing/send-otp",{method:"POST",body:{session_id:t}}),this.startTimer(5*60),this.optTries--,this.resendLink.style.display="none"})}checkOTP(t){return m(this,null,function*(){let e=new URLSearchParams(window.location.search).get("sid")||"";(yield(yield y("/api/novapay-card-processing/check-otp",{method:"POST",body:{session_id:e,code:t}})).json()).status==="preprocessing"?this.showOtpSuccess():this.showErrorMessage()})}getPaymentResult(){return m(this,null,function*(){let t=new URLSearchParams(window.location.search).get("sid")||"",e=yield y("/api/novapay-card-processing/status",{query:{session_id:t}}),a=yield e.json();!e.ok||!["verification_otp","verification_oob"].includes(a.status)?window.location.replace(this.redirectUrl):a.status==="verification_otp"&&this.status!==a.status&&this.changeToOTPPage(),setTimeout(()=>this.getPaymentResult(),5e3),this.status=a.status})}},ni=Ne;document.addEventListener("DOMContentLoaded",()=>{window.location.pathname==="/3ds"&&new ni().init()});})();
